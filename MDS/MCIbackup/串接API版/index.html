<!DOCTYPE html>
<html lang="tw">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><!--指示瀏覽器如何控制網頁的大小和縮放-->

    <script src="js/jquery-3.5.1.min.js"></script>
    

    <script src="datatable/js/1.12.1jquery.dataTables.min.js"></script>
    <script src="datatable/js/2.3.0dataTables.responsive.min.js"></script>
    <!-- RWD Javascript連結-->

    <!-- CSS 連結 -->
    <link rel="stylesheet" href="datatable/css/dataTable.css">
    <link rel="stylesheet" href="datatable/css/responsive.dataTables.min.css">
    <!-- RWD CSS連結 -->

    <link rel="shortcut icon" href="material/icon.ico">
    <title>大量傷病患救護管理系統</title>
    <style>
*{font-size: x-large;font-weight: bold;margin:0;padding:0;list-style:none;text-decoration:none;box-sizing: border-box;user-select: none;font-family: myFirstFont;}
.left{float:left}.right{float:right}.text_right{text-align:right}
html{height: auto;width: 100%;background-color: #d2ecfa;}
body{height: auto;width: 100%;background-color: #d2ecfa6a;background-image: url('material/bg_head.png');background-repeat: repeat-x;}
header{position: relative;width: 100%;height: 100px;padding: 5px 1%;}
main{width: 100%;height: 90%;position: relative;    margin-top: 20px;display: flex;}
@media (max-width: 940px){
  * {font-size: medium;}
  header{height: 75px;}
}
@media (max-width: 780px){
  main{margin-top: 0px;}
}
/*主頁上方標題*/
#logodiv{display: inline; height: 100%;}
#rwdlogo{position: relative;top: 10%;height: 100%;cursor: pointer;}
#timeid{display: flex;align-items: center;height: 100%;margin-right:2% ;font-size: large;color: #0044BC;}
#APP{margin-right:1%;width: 7%;}
#station_title{margin-right:1%;width: 9%;}
#caselist{margin-right:1%;width: 7%;}
#logout{margin-right:2% ;width: 10%}
.custom-btn {height: 70%;top: 15%;cursor: pointer;font-size: 1.5vw;white-space: nowrap;color: #fff;padding: 10px;font-family: 'Lato', sans-serif;font-weight: 900;  font-style: normal;text-shadow: 0px -1px 0px rgba(0,0,0,0.4);text-decoration: none;position: relative;display: flex;box-shadow: inset 0px 1px 0px rgba(255,255,255,1),0px 1px 3px rgba(0,0,0,0.3);outline: none;border: 1px solid #ba6;    border-color: #96C6CF;background: #5EA1A9;border-radius: 5px;align-items: center;justify-content: center;}
.custom-btn:active{  -webkit-transform: translateY(2px);  transform: translateY(2px);}
#dateperiod{margin-right: 8%;}
@media (max-width: 720px)
{
  /*主頁上方標題*/
  header{position: relative;width: 100%;height: auto;display: inline-block;}
  #logodiv{display: inline; width: 100%;    height: auto;}
  #rwdlogo{position: relative;height: auto;width: 100%;}
  #timeid{display: flex;align-items: center;height: 100%;margin-left:2% ;font-size: large;}
  .custom-btn {font-size: 15px;}
  #dateperiod{margin-right: 0%;}
  #APP{width: auto;}
  #station_title{width: auto;}
  #caselist{width: auto;}
  #logout{width: auto;}
  #county{margin-right: 20px;}
}


#main_caselist{display: block;position: relative;width: 100%;height: auto;z-index: 1;margin-bottom: 10%;}
#main_BNdiv{display: none;width: 100%;height: 100%;top: 10px;position: relative;margin-bottom: 10%;}
.sedate{margin: 0px 10px;}
/*maintable*/
.dataTables_wrapper{background-color: transparent;}
.dataTable thead{color: white;}
.dataTables_length label{color: rgb(0, 0, 0);}
.dataTables_length select{color: rgb(0, 0, 0);background-color: white !important;}
.dataTables_info{color: rgb(0, 0, 0) !important;}
.dataTables_filter{margin-bottom: 5px;}
.dataTables_filter label{color: rgb(0, 0, 0);}
#main_table{position: relative;width: 90%;margin-left: 5%;height: auto;top: 10px;}
.display{text-align: center;background-color: #5EA1A9;}
.display  tbody tr:nth-child(odd){background-color: #F4EFDC;}
.state_but_div{display: flex;justify-content: center;}
.state_but{cursor: pointer;white-space: nowrap;color: #fff;padding: 5px 10px;font-family: 'Lato', sans-serif;font-weight: 900;  font-style: normal;text-shadow: 0px -1px 0px rgba(0,0,0,0.4);text-decoration: none;position: relative;display: flex;box-shadow: inset 0px 1px 0px rgba(255,255,255,1),0px 1px 3px rgba(0,0,0,0.3);outline: none;border: 1px solid #ba6;border-color: #7c7c7c;background: #0679D2;border-radius: 50px;align-items: center;justify-content: center;}


/*日期篩選*/
#station_date{margin-bottom: 1%;display: inline-flex;}
.station_name{color: rgb(0, 128, 255);border: none;cursor: pointer;text-decoration:underline;background-color: rgba(0, 0, 0, 0);}
#station_date_input{display: contents;}

@media (max-width: 620px){
  #station_date{display:contents;}
  #station_date_input{display: grid;justify-items: end;}
}








#footer{position: fixed;height: 12vh;width: 100%;bottom: 0;z-index: 0;background-image: url(material/bg_blue.png);display: flex;align-items: flex-end;background-size: 100% 100%;}
#bg_peo{position:relative;bottom: 0;height: 160%;;margin-left: 2%;}


#container{position: relative;width: 100%;height: auto;margin-top: 10px;}
#indatabox_s{display: none;}
#tab-content{width: 83%;height: auto;position: relative;margin-left: 2%;margin-top: 10px;}
#indatarwd{width: 100%;height: 30px;position: relative;display: inline;color:rgb(16, 98, 199);margin-top: 10px;}
#indata_all{width: 100%;height: 80%;}
#pagediv{position: relative;width: calc(100% - 20px);margin-left: 20px;display: flex;}
.nav-item{margin-right: 10px;box-shadow: 0px 0px 3px rgb(149 149 149);width: 200px;height: 65px;display: flex;justify-content: center;align-items: center;color: #0d6efd;background-color: rgb(185,221,252);border-radius: 10px;}
.nav-item:hover {box-shadow: 0 8px 12px 0 rgba(0,0,0,0.2);}
.nav-item_selected{color: black;background-color: rgb(113,185,255);}
.actived{background-color: #fff;    color: #495057;}
#indatabox_l{position: fixed;right: 0;width: 13%;padding-right: 1%;height: 65%;}
.indatabox_l_box{display: flex;align-items: center;border-radius: 10px;background-color: white;border: 2px solid #dddddd;box-shadow: 5px 5px 5px lightblue;height: 15%;margin-top: 5%;}
.indatabox_l_box_icon{height: 100%;display: flex;align-items: center;margin-left: 5%;width: 25px;}
.indatabox_l_box_icon img{width:25px;height:25px;}
.indatabox_l_value{text-align: right;font-size: 1.3vw;width: calc(90% - 25px);}
.indatabox_l_value a{font-size: 1.3vw}
.indatabox_l_value_s{text-align: right;font-size: 1.9vw;width: calc(90% - 25px);}
@media (max-width: 650px){
  .nav-item{width: 170px;height: 50px;}
  #date{float: right;    margin-top: 5px;}

}
@media (max-width: 1305px){
  #tab-content {width: 90%;margin-left: 5%;}
  #indatabox_s{position: relative;width: 90%;height: 200px;margin-left: 8%;display: flex;flex-direction: column;}
  .indatabox_s_box{display: flex;align-items: center;padding: 3px;position: relative;width:43%;margin-left: 3%;height: calc(50% - 20px);margin-top: 10px;text-align: center;border: 2px solid #dddddd;border-radius: 5px;box-shadow: 5px 5px 5px lightblue;background-color: white;}
  #indatabox_l{display: none;}
}

/*案號*/
.green{color: rgb(39,140,86);}
#statistics{margin-left: 1%;position: relative;width: 45%;display: inline-block;}
.lstatistics{position: relative;width: 50%;display: inline-table;height: 30px}
.rstatistics{position: relative;width: 50%;display: inline-table;height: 30px;}
.ststatistics{width: 100%;}
#colordata{position: relative;right:0;width: 53%;background-color: rgb(255, 255, 255);background-color: #d2ecfa;}
#colorcube{position: relative;display: flex;}
#onsitedata{position: relative;margin-top: 20px;width: 99%;max-width: 880px;display: flex;justify-content: space-between;}
.cube{display: flex;position: relative;margin-left: 2%;width: 16.5%;height: 50px;border-radius: 10px;align-items: center;justify-content: center;}
#ondata{position: absolute;width: 20%;display: inline-flex;}
.anvalue{position: relative;display: inline;}
@media (max-width: 1305px){
  #colordata{position: relative;width: 82%;height: 100px;margin-top: 15px;margin-left:8%;display: inline-table;}
  #statistics {position: relative;width: 80%;height: 120px;margin-left: 10%;}
  #onsitedata{width: 100%;height: 60px;display: block;}
  .cube{height: 40px;}
  #ondata{position: absolute;width: 20%;display: inline-flex;color:rgb(16, 98, 199);}
  .anvalue{width: 70%;float: right;display: flex;align-items: flex-end;justify-content: flex-end;margin: 2px 0px;}
}
@media (max-width: 600px){
  #statistics {width: 95%; margin-left: 5%;}
  #ondata{width: 25%;}
}
/*neil 0213 修改成黑色1*/
#gray{color: black;background-color: rgb(180, 191, 196);}
/*OHCA*/.black{color: white;background-color: rgb(59,59,59);}
/*極危險*/.red{background-color: rgb(224, 97, 111);}
/*危險*/.orange{background-color: rgb(244, 210, 57);}
/*輕傷*/.greenyellow{background-color: rgb(128, 185, 90);}


/*colordata-colorbutton*/
.point {position: relative;border: none;padding: 7px;margin: 0px 5px 0px 1px;align-self: center;border-radius: 3px;cursor: default;vertical-align: super}

.value{position: relative;width:auto;top: 60px;left: 40%;font-weight: bolder;}
.ohcavalue{position: relative;left: 15%;width: auto;top: 60px;font-weight: bolder;}
.total{position: relative;left: 71%;width: auto;top: 60px;font-weight: bolder;}


/*main*/
.displaynone{display: none;}
.triage{display: inline-block;padding: 5px 10px;border-radius: 5px;}
.greenttriage {background-color: rgb(128, 185, 90);}
.orangettriage {background-color: rgb(244, 210, 57);}
.redttriage {background-color: rgb(224, 97, 111);} 
.ohcattriage {background-color: rgb(59, 59, 59);color: #f1f1f1;}
#station_table_wrapper{margin-top: 10px;}
/******0831 15:15--- 移除現場數據色塊 hover*/
#selectBTN{position: relative;width: 100%;height: 40px;}
#selectL{width: 50%;height: 30px;display: inline-block;display: flex;justify-content: flex-end;align-items: center;}
#selectR{width: 49%;height: 30px;display: inline-block;display: flex;justify-content: flex-end;}
.select_triage{margin:0% 1.5%;cursor: pointer;height: 100%;}

#select_all {transition: all 0.8s;overflow: hidden;cursor: pointer;}
#select_all:after {content: "";background: white;display: block;position: absolute;padding-top: 300%;padding-left: 300%;margin-left: -20px!important;margin-top: -120%;opacity: 0;transition: all 0.8s;border-radius: 10px;}
#select_all:active:after {padding: 0;margin: 0;opacity: 1;transition: 0s}
.select_state{color: white;background-image: linear-gradient(to right, #005fe0 0%, #0099b9 100%);border-radius: 10px;width: auto;margin-right: 3%;font-size: large;padding: revert;position: relative;cursor: pointer;}
.unselect_state{background-image: none;color: rgb(104 104 104);}


@media (max-width: 700px){
  #selectBTN {height: 80px}
  #selectL{width: 100%;}
  #selectR{width: 100%;margin-top: 15px;}
}











/*傷患後送數據*/
#straight{font-weight: bolder;font-size: larger;display: flex;justify-content: center;font-size: 1.9vw;color:rgb(16, 98, 199);}


.enroutebtn {display: inline-block;border-radius: 4px;background-color: #0000;border: 2px solid #8fccf1;
  box-shadow: 5px 5px 5px lightblue;color: rgb(0, 0, 0);text-align: left;padding: 15px 5px 15px 5px;width: 90%;transition: all 0.5s;cursor: pointer;}
.arrivebtn {display: inline-block;border-radius: 4px;background-color: #0000;border: 2px solid #8fccf1;
  box-shadow: 5px 5px 5px lightblue;color: rgb(0, 0, 0);text-align: left;padding: 15px 5px 15px 5px;width: 90%;transition: all 0.5s;cursor: pointer;}
.arrivebtn span {cursor: pointer;display: inline-block;position: relative;transition: 0.5s;color:rgb(94,154,107)}
.arrivebtn span:after {content: '\00bb';position: absolute;opacity: 0;top: 0;right: -20px;transition: 0.5s;}
.arrivebtn:hover span {padding-top: 5px;font-size: 18px;}
.nothosbtn {display: inline-block;border-radius: 4px;background-color: #0000;border: 2px solid #8fccf1;
  box-shadow: 5px 5px 5px lightblue;color: rgb(0, 0, 0);text-align: left;padding: 15px 5px 15px 5px;width: 90%;transition: all 0.5s;cursor: pointer;}
.nothosbtn span {cursor: pointer;display: inline-block;position: relative;transition: 0.5s;color:rgb(94,154,107)}
.nothosbtn span:after {content: '\00bb';position: absolute;opacity: 0;top: 0;right: -20px;transition: 0.5s;}
.nothosbtn:hover span {padding-top: 5px;font-size: 18px;}
.arrvehbtn {display: inline-block;border-radius: 4px;background-color: #0000;border: 2px solid #8fccf1;
  box-shadow: 5px 5px 5px lightblue;color: rgb(0, 0, 0);text-align: left;padding: 15px 5px 15px 5px;width: 90%;transition: all 0.5s;cursor: pointer;}
.arrvehbtn span {cursor: pointer;display: inline-block;position: relative;transition: 0.5s;color:rgb(94,154,107)}
.arrvehbtn span:after {content: '\00bb';position: absolute;opacity: 0;top: 0;right: -20px;transition: 0.5s;}
.arrvehbtn:hover span {padding-top: 5px;font-size: 18px;}
#none{display: none;}
.tablehide{display: none;}
.inbr{display:block;}













/*list1特徵照片*/
#myModal {display: none;position: fixed;z-index: 1;padding-top: 70px;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0,0,0);background-color: rgba(0, 0, 0, 0.251);}
#modal-content {background-color: #fefefe;border: 1px solid #888;width: 80%;height: 80%;top: 10%;left: 10%;position: absolute;}
#largepicchoosediv{position: absolute;top: 80%;height: 10%;min-height: 55px;left: 25%;width: 50%;overflow-y: hidden;display: flex;box-shadow: 0px 0px 5px black;}
#largepicchoosediv img{max-height: 100%;max-width: 100%;width: auto;height: auto;margin-right: 10pt;top: 0;cursor: pointer;}
#largepicdiv{position: absolute;height: 65%;top: 10%;left: 15%;width: 70%;display: flex;}
#largepicdiv img{max-height: 100%;max-width: 100%;margin: auto;}
#delpdf{border-style: none;height: 100%;width: 100%;}
.scrollho::-webkit-scrollbar-track{background-color: rgba(0,0,0,0);border-radius: 10px;}
.scrollho::-webkit-scrollbar{width: 13px;background-color: rgba(0,0,0,0);}
.scrollho::-webkit-scrollbar-thumb{border-radius: 10px;    background-image: -webkit-gradient(linear,right bottom, left top, color-stop(0.44, rgb(208 215 229)), color-stop(0.72, rgb(155 192 240)), color-stop(0.86, rgb(133 162 246)));}

#largepicchoosediv{position: absolute;top: 80%;height: 10%;left: 25%;width: 50%;overflow-y: hidden;display: flex;box-shadow: 0px 0px 5px black;}

/*list1救護紀錄*/
#myamrecord {display: none;position: fixed;z-index: 1;padding-top: 100px;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgba(0,0,0,0.4);}
#amrecord-content {background-color: #fefefe;width: 80%;left: 10%;height: 80%;top: 10%;position: absolute;}
#record{display: flex;justify-content: center;align-items: center;position: absolute;height: 90%;top: 5%;width: 80%;left: 10%;}
#record img{max-height: 90%;}








/*list1傷患資料*/
.feature {display: none;position: fixed;z-index: 1;padding-top: 100px;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0,0,0);background-color: rgba(0,0,0,0.4);}
#feature-content {background-color: #fefefe;margin: auto;padding: 1%;border: 1px solid #888;width: 60%;height: 80%;}
#situation{position: relative;padding: 15px;width: 100%;height: 100%;border-radius: 10px;border: 2px solid #b7b7b7;}
#sitone{width: 25%;height: 100%;position: relative;}
#sittitle{color: #1075fa;font-size: x-large;}
.injeveAId{display: inline-flex;margin-top: 15px;font-size: x-large;}
.injeveAId_text{font-size: large;}
#sitline{height:95%;width:75%;position: relative;border-left-style:groove}
/*list1傷患資料-特徵說明*/
.sittoptitle{position: relative;left: 20px;color: #1075fa}
.sitright{position: relative;width: 100%;height: 50%;}
.sit{border-radius: 5px;border: 2px solid #b7b7b7;width: 88%;left: 12%;position: relative;height: 78%;font-size: 1.3vw;padding: 5px;}
/*list1傷患資料-補充說明*/
#sitrightdown{position: relative;width: 80%;height: 43%;}
.antisibr{display: none;}
@media (max-width: 950px){
  #sitone{width: 100%;height: 45%;}
  #sittitle{float: left;width: 100%;height: 25px;font-size: large;}
  .injevediv {width: 50%;height: calc(33.3% - 8.3px);float: left;}
  .injeveAId{margin: 0;font-size: medium;}
  #sitline{width: 100%;height: 55%;border-left-style: none;border-top-style: groove;padding: 5px}
  .sittoptitle{font-size: large;width: 20%;float: left;left: 0;}
  .sibr{display: none;}
  .injeveAId_text{font-size: medium;}
  .sit{float: left;width: 76%;left: 2%;height: 80%;}
  .antisibr{display: block;}
}







/*遮罩*/
#hide{width: 100%;top: -100px;height: calc(100% + 100px);position: absolute;}
#hide1{min-width: 100%;min-height: 100vh;position: fixed;top: 0;left: 0;z-index: 2;overflow-y: auto;background-color: rgba(0,0,0,0.4);display: flex;}
#hide1 img{margin: auto;max-width: 80vw;max-height: 80vh;}
#hideapp{justify-content: center;align-items: center;min-width: 100%;min-height: 100vh;position: fixed;top: 0;left: 0;z-index: 2;overflow-y: auto;background-color: rgba(0,0,0,0.4);display: flex;}
#hideapp a img{margin: auto;max-width: 40vw;max-height: 80vh;}
#hideapp a{margin: 0 5%;}
@media (max-width: 500px){
  #hideapp{flex-direction: column;}
  #hideapp a img{margin: auto;max-width: 80vw;max-height: 40vh;}
}
    </style>


</head>

<body id="body">
  <header>
    <div id="logodiv" class="left">
      <a onclick="location.reload()"><img src="material/LOGO.png" title="回首頁" id="rwdlogo"></a>
    </div>
    <button id="logout" class="custom-btn right" onclick="gologout()">回到選擇系統</button>
    <button id="caselist" class="custom-btn right" onclick="location.reload()">案件列表</button>
    <button id="APP" class="custom-btn right"  onclick="app()">APP下載</button>
    <button id="station_title" class="custom-btn right patient_page" style="display: none;" onclick="back_station_btn()">救護站列表</button>
    <div id="timeid" class="right">
      最後更新：<span id="timenow"></span>
    </div>
  </header>
  <main>
    
    <!--！案件列表！-->
    <div id="main_caselist">
      <div id="dateperiod" class="right"><div class="right" id="county">案發縣市：<select id="sel_county" onchange="filt_case()"><option selected value='全部'>全部</option></select></div><div class="left" id="date">日期區間：<input type="date" class="sedate" id="sdate" onchange="filt_case();sel_county_renew()">到<input type="date" class="sedate" id="edate" onchange="filt_case();sel_county_renew()"></div></div>
      <div id="main_table" class="left">
        <table id="data_table" class="display dtr-control"></table>
      </div>
    </div>


    <footer id="footer">
      <img src="material/patient.png" id="bg_peo">
    </footer>
    
    <!--！進入案件後！-->
    <div id="main_BNdiv">
      <!--案號與統計表-->
      <div id="statistics" class="left">
        <div class="lstatistics left">大傷案件：<a id="casePushNAME"></a></div>
        <div class="rstatistics left">目前狀態：<a id="casePushSTATE"></a></div>
        <div class="lstatistics left">大傷案號：<a id="casePushID"></a></div>
        <div class="rstatistics left">案發縣市：<a id="casePushCOUNTY"></a></div>
        <div class="lstatistics left">開案時間：<a id="casePushTIME"></a></div>
        <div class="rstatistics left">案發時間：<a id="casePushCASETIME"></a></div>
        <div class="lstatistics left patient_page" id="statistics_staname">救護站名：<a id="stationPushNAME"></a></div>
      </div>
      
      
      <!--colordataqqqq-->
      <div id="colordata" class="left">
        <div id="colorcube">
          <div id="gray" class="cube left">總計<a id="pushgary_data"></a></div>
          <div class="cube left black"><a id="pushohca_data"></a></div>
          <div class="cube left red"><a id="pushred_data"></a></div>
          <div class="cube left orange"><a id="pushorg_data"></a></div>
          <div class="cube left greenyellow"><a id="pushgre_data"></a></div>
        </div>
        <div id="onsitedata">
          <div id="ondata">現場數據</div>
          <div class="anvalue left" style="margin-left: 115px;">
            <button class="black point""></button>比例：<a id="pushohca_value"></a>%
          </div>
          <div class="anvalue left">
            <button class="red point"></button>
            <button class="orange point"></button>
            <button class="greenyellow point"></button>比例：<a id="pushrog_value"></a>%
          </div>
          <div class="anvalue left">總送醫比例：<a id="pushtotal_value"></a>%</div>
        </div>
      </div>



      <div id="indatabox_s" class="left">
        <div id="indatarwd" class="left">傷患後送數據</div>
        <div id="indata_all">
          <div id="indata1" class="indatabox_s_box left">
            <div class="indatabox_l_box_icon left"><img src="material/data_1@2x.png"></div>
            <div class="indatabox_l_value_s ">
              <a class="green">後送中人數</a><br> 
              <a id="pushenroute_valuepho" class="indatabox_l_value_s"></a>人(<a id="pushenroute_ppho" class="indatabox_l_value_s"></a>%)
            </div>      
          </div>
          <div id="indata2" class="indatabox_s_box left">
            <div class="indatabox_l_box_icon left"><img src="material/data_2@2x.png"></div>
            <div class="indatabox_l_value_s ">
              <a class="green">到院人數</a><br> 
              <a id="pusharrive_valuepho" class="indatabox_l_value_s"></a>人(<a id="pusharrive_ppho" class="indatabox_l_value_s"></a>%)
            </div>
          </div>
          <div id="indata3" class="indatabox_s_box left">
            <div class="indatabox_l_box_icon left"><img src="material/data_3@2x.png"></div>
            <div class="indatabox_l_value_s ">
              <a class="green">未送醫人數</a><br> 
              <a id="pushnothos_valuepho" class="indatabox_l_value_s"></a>人(<a id="pushnothos_ppho" class="indatabox_l_value_s"></a>%)
            </div>
          </div>
          <div id="indata4" class="indatabox_s_box left">
            <div class="indatabox_l_box_icon left"><img src="material/data_4@2x.png"></div>
            <div class="indatabox_l_value_s ">
              <a class="green">後送車輛數</a><br> 
              <a id="pusharrveh_valuepho" class="indatabox_l_value_s"></a>臺
            </div>
          </div>
        </div>
      </div>
      


      <div id="container" class="left">
        <div  id="indatabox_l">
          <div id="straight">傷患後送數據</div>
          <div class="indatabox_l_box">
            <div class="indatabox_l_box_icon left"><img src="material/data_1@2x.png"></div>
            <div class="indatabox_l_value ">
              <a class="green">後送中人數</a><br> 
              <a id="pushenroute_value" class="indatabox_l_value"></a>人(<a id="pushenroute_p" class="indatabox_l_value"></a>%)
            </div>
          </div>
          <div class="indatabox_l_box">
            <div class="indatabox_l_box_icon left"><img src="material/data_2@2x.png""></div>
            <div class="indatabox_l_value ">
              <a class="green">到院人數</a><br> 
              <a id="pusharrive_value" class="indatabox_l_value"></a>人(<a id="pusharrive_p" class="indatabox_l_value"></a>%)
            </div>
          </div>
          <div class="indatabox_l_box">
            <div class="indatabox_l_box_icon left"><img src="material/data_2@2x.png""></div>
            <div class="indatabox_l_value ">
              <a class="green">未送醫人數</a><br> 
              <a id="pushnothos_value" class="indatabox_l_value"></a>人(<a id="pushnothos_p" class="indatabox_l_value"></a>%)
            </div>
          </div>
          <div class="indatabox_l_box">
            <div class="indatabox_l_box_icon left"><img src="material/data_2@2x.png""></div>
            <div class="indatabox_l_value ">
              <a class="green">後送車輛數</a><br> 
              <a id="pusharrve_value" class="indatabox_l_value"></a>臺
            </div>
          </div>
        </div>

        <div id="pagediv" class='patient_page'>
          <div id="patient" class="nav-item nav-item_selected left" onclick="changepage('patient')">傷病患清單</div>
          <div id="hos" class="nav-item left" onclick="changepage('hos')">後送醫院收治情形</div>
        </div>

          <!--頁籤list-->
          <div id="tab-content" class="left">
            <div id="home" class="changepage patient_page">
              <div id="selectBTN">
                <div id="selectL" class="left">傷票級別
                  <img id="select_all_triage" class="select_triage" src="material/select_all_triage.png" title="全部" onclick="select_toggle('select_all_triage')">
                  <img id="select_ohca" class="select_triage" src="material/square_select_ohca_true.png" title="OHCA" onclick="select_toggle('select_ohca')">
                  <img id="select_red" class="select_triage" src="material/square_select_red_true.png" title="極危險" onclick="select_toggle('select_red')">
                  <img id="select_org" class="select_triage" src="material/square_select_org_true.png" title="危險" onclick="select_toggle('select_org')">
                  <img id="select_gre" class="select_triage" src="material/square_select_gre_true.png" title="輕傷" onclick="select_toggle('select_gre')">
                </div>
                <div id="selectR" class="left">
                  <button id="select_all" class="select_state" onclick="select_state('select_all')">全部</button>
                  <button id="select_onsite" class="select_state" onclick="select_state('select_onsite')">現場</button>
                  <button id="select_enroute" class="select_state" onclick="select_state('select_enroute')">送醫中</button>
                  <button id="select_arr" class="select_state" onclick="select_state('select_arr')">已到院</button>
                </div>
              </div>                                          
              <!--傷病患清單表格-->
              <table id="patient_table" class="display dtn-conrtol"></table>
                <!-- 特徵照片 -->
              <div id="myModal" style="display: none;">
                  <!--窗體外隱藏-->
                  <div id="hide" onclick="hidebox('myModal')"></div>
                    <!-- 特徵照片 content -->
                  <div id="modal-content">
                    <div id="largepicdiv"></div>
                    <div id="largepicchoosediv" class="scrollho"></div>
                  </div>
              </div>
                    
              <!-- 救護紀錄 -->
              <div id="myamrecord" style="display: none;">
                <!--窗體外隱藏-->
                <div id="hide" onclick="hidebox('myamrecord')"></div>
                <!-- 救護紀錄 content -->
                <div id="amrecord-content">
                  <div id="record"></div>
                </div>
              </div>

              <!--傷患資料-->
              <div id="idfeature" class="feature" style="display: none;">
                <!--窗體外隱藏-->
                <div id="hide" onclick="hidebox('idfeature')"></div>
                <!-- Modal content -->
                <div id="feature-content">
                  <div id="situation">
                    <!--左-->
                    <div id="sitone" class="left">
                      <a id="sittitle">傷患評估</a>
                      <div class="injevediv"><a class="injeveAId">檢傷編碼:</a><br class="sibr"><a class="injeveAId_text" id="injeveID"></a></div>
                      <div class="injevediv"><a class="injeveAId">姓名:</a><br class="sibr"><a class="injeveAId_text" id="injeveNAME"></a></div>
                      <div class="injevediv"><a class="injeveAId">電話:</a><br class="sibr"><a class="injeveAId_text" id="injevePHONE"></a></div>
                      <div class="injevediv"><a class="injeveAId">性別:</a><br class="sibr"><a class="injeveAId_text" id="injeveSEX"></a></div>
                      <div class="injevediv"><a class="injeveAId">年齡:</a><br class="sibr"><a class="injeveAId_text" id="injeveAGE"></a></div>
                    </div>
                    <!--分隔線-->
                    <div id="sitline" class="left">
                      <div class="sitright">
                        <div class="sittoptitle">特徵說明</div>
                        <div id="sittop" class="sit"></div>
                      </div>
                      <div class="sitright">
                        <div class="sittoptitle">補充說明</div>
                        <div id="sitdown" class="sit"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!--list2內容-->
            <div id="menu1" class="changepage patient_page">
            </div>

<!--
            <div id="station_page" class="station_page">
              <div id="station" class="nav-item nav-item_selected left">救護站列表</div>
            </div>
-->

            <div id="station_content" class="station_page">
                <div class="right" id="station_date">日期區間：<div id="station_date_input"><input type="datetime-local" class="sedate" id="station_sdate" onchange="filt_station()"><div>到<input type="datetime-local" class="sedate" id="station_edate" onchange="filt_station()"></div></div></div>
                <table id="station_table" class="display dtn-conrtol"></table>
            </div>


          </div>
        </div>
      </div>
  </main>
    
  <script type=text/javascript>


const permission='00'
//const permission='${country}'
const renewt = 5000;//更新頻率
const api_CaseList = "http://172.16.30.127:9527/MCIWebApi/MCIWebApi/CaseList";
const api_station = "http://172.16.30.127:9527/MCIWebApi/MCIWebApi/CaseStationDetail"
const api_CaseDetail ="http://172.16.30.127:9527/MCIWebApi/MCIWebApi/CaseDetail";
const county_order=["基隆市","臺北市","台北市","新北市","桃園市","新竹市","新竹縣","苗栗縣","臺中市","台中市","彰化縣","南投縣","雲林縣",
              "嘉義市","嘉義縣","臺南市","台南市","高雄市","屏東縣","臺東縣","台東縣","宜蘭縣","花蓮縣","澎湖縣","金門縣","連江縣"]

var minDate='0000/00/00 00:00:00';//案件過濾起始時間
var maxDate='9999/99/99 99:99:99';//案件過濾結束時間
var station_minDate='0000/00/00 00:00:00';//救護站過濾起始時間
var station_maxDate='9999/99/99 99:99:99';//救護站過濾結束時間
var case_table;//案件表格
var station_table;//救護站表格
var patient_table;//病人表格
var hos_table;//病人表格
var datalist;//案件資料
var present_datalist_list=[];//案件編號list
var date_datalist=[]//案件資料時間篩選
var present_datalist=[]//案件資料呈現
var case_id='';//大傷案件編號
var stationdata={};//該案件救護站資料
var present_stationdata=[];//救護站資料呈現
var present_stationdata_list=[];//案件編號list
var station_num;//救護站號
var filter_triage=['select_ohca','select_red','select_org','select_gre','']
var filter_state=["select_onsite",'select_enroute','select_arr','']
var present_patientdata_list=[];//病人編號list
var patientdata={};//該案件病人資料
var present_patientdata=[];//病人資料呈現
var pagination='home';//目前頁面
var hos_data=[];//後送醫院收治情形資料
var select_pid=''//詳細視窗病人ID




case_table_init()

setInterval(function () {update_all()},renewt);

//app下載頁面
function app() {
  var div= document.createElement("div");
  div.id="hideapp"
  div.innerHTML='<a href="itms-services://?action=download-manifest&amp;url=https://nfaemsap3.nfa.gov.tw/MCI_download/download/ios/MCI_iOS.plist"><img src="material/IOS.png"></a><a href="https://nfaemsap3.nfa.gov.tw/MCI_download/download/android/MCI_And.apk"><img src="material/Android.png"></a>' ;
  div.setAttribute('onclick', 'rmdiv("hideapp")');
  document.getElementById("body").append(div);
}


// case_table 初始化
function case_table_init() {
  $.post( api_CaseList, {"city_code":permission}).done(function( data ) {
    timenow()
    datalist=data.Data;
    console.log(data);
    date_datalist=JSON.parse(JSON.stringify(datalist));
    present_datalist=JSON.parse(JSON.stringify(date_datalist));
    present_datalist_list=present_datalist.map(x => x.case_id);
    sel_county_renew()

    case_table = $('#data_table').DataTable( {
      "lengthMenu":[[5,10,20,50],[5,10,20,50]],"iDisplayLength":5,
      "language":{"processing": "處理中...","loadingRecords": "載入中...","lengthMenu": "每頁顯示 _MENU_ 筆資料","info": "顯示第 _START_ 至 _END_ 筆資料，共 _TOTAL_ 筆",
        "infoEmpty": "顯示第 0 至 0 筆資料，共 0 筆","infoFiltered": "","search": "搜尋:",
        "paginate": {"first": "第一頁","previous": "上一頁","next": "下一頁","last": "最後一頁"},
        "emptyTable": "無資料","zeroRecords": "無資料",
        "oAria": {"sSortAscending": ": 以升序排列此列","sSortDescending": ": 以降序排列此列"}
      } ,
      data: present_datalist,
      columns: [
        {title: '',data: 'o'},
        {title: '項次',data: 'o'},
        {title: '大傷案號',data: 'case_id'},
        {title: '大傷名稱',data:'case_name','render':function(case_name){if(!case_name){return '-';}else{return case_name}}},
        {title: '案發縣市',data:'case_county','render':function(case_county){if(!case_county){return '-';}else{return case_county}}},
        {title: '開案時間',data:'case_time','render':function(case_time){if(!case_time){return '-';}else{return case_time}}},
        {title: '案件狀態',data: 'case_state',
          render: function (data, type, row) {
            return '<div class="state_but_div"><button type="button" class="state_but" onclick="casestate_btn(\''+row.case_id+'\')" id="casehome">'+data+'</button></div>'  
          }
        }],
      responsive: {details: {type: 'column'},},
      columnDefs: [ 
        {targets:0,className: 'dtr-control',orderable: false,},
        {targets: [0],width:"3%"},
        {targets: [1],orderable: false,width:"3%"},
        {targets: [2],responsivePriority: 50000},
        {targets: [3],responsivePriority: 1,orderable: false},
        {targets: [4],responsivePriority: 100000},
        {targets: [5]},
        {targets: [6],responsivePriority: 1,width:"10%"},
      ],
      order: [ 0, 'ace' ],
    });
    case_table.on('order.dt search.dt',function() {
      case_table.column(1, {search: 'applied',order: 'applied'}).nodes().each(function(cell, i) {
        cell.innerHTML = i + 1;
      });
    }).draw();
    var data_table = document.getElementById('data_table')
    data_table.style.width='100%';
  });
}




// station_table 初始化
function station_table_init() {
  $.post( api_station, {"case_id":case_id}).done(function( data ) {
    timenow()
    stationdata=data.Data;
    present_stationdata=JSON.parse(JSON.stringify(stationdata.station));
    present_stationdata_list=present_stationdata.map(x => x.station_num);
    station_table = $('#station_table').DataTable( {
      "lengthMenu":[[5,10,20,50],[5,10,20,50]],"iDisplayLength":5,
      "language":{"processing": "處理中...","loadingRecords": "載入中...","lengthMenu": "每頁顯示 _MENU_ 筆資料","info": "顯示第 _START_ 至 _END_ 筆資料，共 _TOTAL_ 筆",
        "infoEmpty": "顯示第 0 至 0 筆資料，共 0 筆","infoFiltered": "","search": "搜尋:",
        "paginate": {"first": "第一頁","previous": "上一頁","next": "下一頁","last": "最後一頁"},
        "emptyTable": "無資料","zeroRecords": "無資料",
        "oAria": {"sSortAscending": ": 以升序排列此列","sSortDescending": ": 以降序排列此列"}
      } ,
      data: present_stationdata,
      columns: [
            {title: '',data: 'o'},
            {title: '項次',data: 'o'},
            {title: '救護站號',data: 'station_num'},
            {title: '救護站名',data: 'station_name',render: function (data, type, row) {
              return '<a class="station_name" onclick="station_btn(\''+row.station_num+'\')">'+data+'</a>'
            },},
            {title: '開始時間',data: 'station_stime','render':function(station_stime){if(!station_stime){return '-';}else{return station_stime}}},
            {title: '結束時間',data: 'station_etime','render':function(station_etime){if(!station_etime){return '-';}else{return station_etime}}},
            {title: '總檢傷人數',data: 'station_totpeo',
          render: function (data, type, row) {
            /*neil 0214 新增功能*/
            return '<button class="black point"></button>'+(data.black=='0'?'-':data.black)+'<br><button class="red point"></button>'+(data.red=='0'?'-':data.red)+'<br><button class="orange point"></button>'+(data.orange=='0'?'-':data.orange)+'<br><button class="greenyellow point"></button>'+(data.green=='0'?'-':data.green)
          }},
            {title: '未送醫人數',data: 'station_nohos',
          render: function (data, type, row) {
            /*neil 0214 新增功能*/
            return '<button class="black point"></button>'+(data.black=='0'?'-':data.black)+'<br><button class="red point"></button>'+(data.red=='0'?'-':data.red)+'<br><button class="orange point"></button>'+(data.orange=='0'?'-':data.orange)+'<br><button class="greenyellow point"></button>'+(data.green=='0'?'-':data.green)
          }},
            {title: '送醫中人數',data: 'station_rouhos',  
          render: function (data, type, row) {
            /*neil 0214 新增功能*/
            return '<button class="black point"></button>'+(data.black=='0'?'-':data.black)+'<br><button class="red point"></button>'+(data.red=='0'?'-':data.red)+'<br><button class="orange point"></button>'+(data.orange=='0'?'-':data.orange)+'<br><button class="greenyellow point"></button>'+(data.green=='0'?'-':data.green)
          }},
            {title: '到院人數',data: 'station_inhos',
          render: function (data, type, row) {
            /*neil 0214 新增功能*/
            return '<button class="black point"></button>'+(data.black=='0'?'-':data.black)+'<br><button class="red point"></button>'+(data.red=='0'?'-':data.red)+'<br><button class="orange point"></button>'+(data.orange=='0'?'-':data.orange)+'<br><button class="greenyellow point"></button>'+(data.green=='0'?'-':data.green)
          }} ],
      responsive: {details:{type: 'column'}},
      columnDefs: [ 
        {targets:0,className: 'dtr-control',orderable: false,},
        {targets: [1],orderable: false},
        {targets: [2],orderable: false},
        {targets: [3],orderable: false,responsivePriority: 1,width:"10%"},
        {targets: [4],responsivePriority: 700000},
        {targets: [5],responsivePriority: 800000},
        {targets: [6],orderable: false,responsivePriority: 1,width:"10%"},
        {targets: [7],orderable: false,responsivePriority: 1,width:"10%"},
        {targets: [8],orderable: false,responsivePriority: 1,width:"10%"},
        {targets: [9],orderable: false,responsivePriority: 1,width:"10%"},
      ]
      
      
    ,
      order: [ 0, 'ace' ],
    });
    station_table.on('order.dt search.dt',function() {
      station_table.column(1, {search: 'applied',order: 'applied'}).nodes().each(function(cell, i) {
        cell.innerHTML = i + 1;
      });
    }).draw();
    var st = document.getElementById('station_table')
    st.style.width='100%';
    update_statistics()
    datapush() 
  });
}



// patient_table 初始化
function patient_table_init() {
  $.post( api_CaseDetail, {"case_id":case_id,"station_No":station_num}).done(function( data ) {
    timenow()
    patientdata=data.Data
    console.log(patientdata);
    present_patientdata=JSON.parse(JSON.stringify(patientdata.patient));
    console.log(present_patientdata);
    present_patientdata_list=present_patientdata.map(x => x.id);
    console.log(present_patientdata_list);
    patient_table = $('#patient_table').DataTable( {
      "lengthMenu":[[5,10,20,50],[5,10,20,50]],"iDisplayLength":5,
      "language":{"processing": "處理中...","loadingRecords": "載入中...","lengthMenu": "每頁顯示 _MENU_ 筆資料","info": "顯示第 _START_ 至 _END_ 筆資料，共 _TOTAL_ 筆",
        "infoEmpty": "顯示第 0 至 0 筆資料，共 0 筆","infoFiltered": "","search": "搜尋:",
        "paginate": {"first": "第一頁","previous": "上一頁","next": "下一頁","last": "最後一頁"},
        "emptyTable": "無資料","zeroRecords": "無資料",
        "oAria": {"sSortAscending": ": 以升序排列此列","sSortDescending": ": 以降序排列此列"}
      } ,
        data: present_patientdata,
        columns: [
          {title: '',data: 'o'},
          {title: '項次',data:'o'},
          {title: '檢傷編碼',data: 'id',
            render: function (data, type, row) {
              var classname;
              if (row.state=='OHCA') {classname='ohcattriage' }
              else if (row.state=='極危險') {classname='redttriage'}
              else if (row.state=='危險') {classname='orangettriage'}
              else if (row.state=='輕傷') {classname='greenttriage'}
              return '<div class="triage ' + classname + '" >'+row.id+'</div> '
            },
          },
          {title: '姓名',data:'name','render':function(name){if(!name){return '-';}else{return name}}},
          {title: '性別',data: 'sex','render':function(sex){if(!sex){return '不明';}else{return sex}}},
          {title: '年齡',data: 'age','render':function(age){if(!age){return '-';}else{return age}}},
          {title: '狀態',data:'loca','render':function(loca){if(!loca){return '-';}else{return loca}}},
          {title: '後送車輛',data:'car','render':function(car){if(!car){return '-';}else{return car}}},
          {title: '後送醫院',data:'hos','render':function(hos){if(!hos){return '-';}else{return hos}}},
          {title: '離開現場時間',data: 'levtime','render':function(levtime){if(!levtime){return '-';}else{return levtime}}},
          {title: '到院時間',data: 'arrtime','render':function(arrtime){if(!arrtime){return '-';}else{return arrtime}}},
          {title: '特徵照片',data: 'pho',
            render: function (data, type, row) {return '<div class="state_but_div"><button type="button" class="state_but" onclick="myBtn(\''+row.id+'\')">檢視</button></div>'}, 
          },
          {title: '救護紀錄',data: 'recor',
            render: function (data, type, row) {return '<div class="state_but_div"><button type="button" class="state_but" onclick="record(\''+row.id+'\')">檢視</button></div>'},
          },
          {title: '傷患資訊',data: 'feature',
          
            render: function (data, type, row) {console.log(typeof row.id)
              return '<div class="state_but_div"><button type="button" class="state_but" onclick="feafun(\''+row.id+'\')">檢視</button></div>'}, 
          },
        ],
        responsive: {details:{type: 'column'}},
        columnDefs: [
          {targets:0,className: 'dtr-control',orderable: false,},
          {targets: [0],width:"3%"},
          {targets: [1],responsivePriority: 1,orderable: false,width:"3%"},
          {targets: [2],responsivePriority: 100},
          {targets: [3],responsivePriority: 1,orderable: false},
          {targets: [4],responsivePriority: 100000},
          {targets: [5],responsivePriority: 100000},
          {targets: [6],responsivePriority: 1,width:"10%"},
          {targets: [11,12,13],width:"8%",responsivePriority: 10000,orderable: false},
        ],
        order: [ 0, 'ace' ],
    });
    patient_table.on('order.dt search.dt',function() {
      patient_table.column(1, {
        search: 'applied',
        order: 'applied'
      }).nodes().each(function(cell, i) {cell.innerHTML = i + 1;});
    }).draw();
    var data_table = document.getElementById('patient_table')
    data_table.style.width='100%';
    update_statistics()//更新statistics左上角分析資料
    hos_table_init()//更新hos_table
    datapush() 
  });
}
 



// hos_table 初始化
function hos_table_init() {
  //list2後送醫院收治情況
  hos_data=[]
  var hos_list=[]
  //放值
  var hos_dataob_num={"hos":"","hos_level":"","hosspace":"","hosAllPeo":0,"goHos":{"goHosBLACK":0,"goHosRED":0,"goHosORG":0,"goHosGRE":0},"arrHos":{"arrHosBLACK":0,"arrHosRED":0,"arrHosORG":0,"arrHosGRE":0},"totalHos":{"totalHosBLACK":0,"totalHosRED":0,"totalHosORG":0,"totalHosGRE":0}}; 
  for (let i = 0;i<patientdata.patient.length;i++) { //Keys是將Object轉換成list[]
    if (patientdata.patient[i].hos!=""){
      if (hos_list.includes(patientdata.patient[i].hos)==false)  {   
        hos_list.push(patientdata.patient[i].hos)            //深淺拷貝轉換
        hos_data.push(JSON.parse(JSON.stringify(hos_dataob_num)))
        hos_data[hos_data.length-1]['hos']=patientdata.patient[i].hos;
        hos_data[hos_data.length-1]['hos_level']=patientdata.patient[i].hos_level;
        hos_data[hos_data.length-1]['hosspace']=patientdata.patient[i].hosspace;
      }
      var num = hos_list.indexOf(patientdata.patient[i].hos)

      //醫院收治總人數 
      hos_data[num]['hosAllPeo']+=1;
      //已到院
      if (patientdata.patient[i].state=="OHCA") {
        if (patientdata.patient[i].loca=="已到院") {hos_data[num].arrHos.arrHosBLACK+=1}
        else if (patientdata.patient[i].loca=="送醫中") {hos_data[num].goHos.goHosBLACK+=1}
        hos_data[num].totalHos.totalHosRED+=1
      }
      else if (patientdata.patient[i].state=="極危險") {
        if (patientdata.patient[i].loca=="已到院") {hos_data[num].arrHos.arrHosRED+=1}
        else if (patientdata.patient[i].loca=="送醫中") {hos_data[num].goHos.goHosRED+=1}
        hos_data[num].totalHos.totalHosRED+=1
      }
      else if (patientdata.patient[i].state=="危險") {
        if (patientdata.patient[i].loca=="已到院") {hos_data[num].arrHos.arrHosORG+=1}
        else if (patientdata.patient[i].loca=="送醫中") {hos_data[num].goHos.goHosORG+=1}
        hos_data[num].totalHos.totalHosORG+=1
      }
      else if (patientdata.patient[i].state=="輕傷") {
        if (patientdata.patient[i].loca=="已到院") {hos_data[num].arrHos.arrHosGRE+=1}
        else if (patientdata.patient[i].loca=="送醫中") {hos_data[num].goHos.goHosGRE+=1}
        hos_data[num].totalHos.totalHosGRE+=1
      }
    }
  }

  hos_table = $('#hos_table').DataTable( { 
    "language":{"processing": "處理中...","loadingRecords": "載入中...","lengthMenu": "每頁顯示 _MENU_ 筆資料","info": "顯示第 _START_ 至 _END_ 筆資料，共 _TOTAL_ 筆",
        "infoEmpty": "顯示第 0 至 0 筆資料，共 0 筆","infoFiltered": "","search": "搜尋:",
        "paginate": {"first": "第一頁","previous": "上一頁","next": "下一頁","last": "最後一頁"},
        "emptyTable": "無資料","zeroRecords": "無資料",
        "oAria": {"sSortAscending": ": 以升序排列此列","sSortDescending": ": 以降序排列此列"}
      },
    'paging':false,'info':false,
    columns: [
      { title: '收治醫院',data: 'hos'},
      { title: '醫療能力分級',data:'hos_level','render':function(hos_level){if(!hos_level){return '-';}else{return hos_level}}},
      { title: '可容納人數',data: 'hosspace','render':function(hosspace){if(!hosspace){return '-';}else{return hosspace}}},
      { title: '已送往人數',data: 'hosAllPeo','render':function(hosAllPeo){if(!hosAllPeo){return '-';}else{return hosAllPeo}}},
      { title: '送醫中',data: 'goHos',
        render: function (data, type, row) {
          /*neil 0214 新增功能*/
          return '<button class="black point"></button>'+(data.goHosBLACK=='0'?'-':data.goHosBLACK)+'<br><button class="red point"></button>'+(data.goHosRED=='0'?'-':data.goHosRED)+'<br><button class="orange point"></button>'+(data.goHosORG=='0'?'-':data.goHosORG)+'<br><button class="greenyellow point"></button>'+(data.goHosGRE=='0'?'-':data.goHosGRE)
        }
      },
      { title: '已到院',data: 'arrHos',
        render: function (data, type, row) {
          /*neil 0214 新增功能*/
          return '<button class="black point"></button>'+(data.arrHosBLACK=='0'?'-':data.arrHosBLACK)+'<br><button class="red point"></button>'+(data.arrHosRED=='0'?'-':data.arrHosRED)+'<br><button class="orange point"></button>'+(data.arrHosORG=='0'?'-':data.arrHosORG)+'<br><button class="greenyellow point"></button>'+(data.arrHosGRE=='0'?'-':data.arrHosGRE)
        }
      },
      { title: '總計',data: 'totalHos',
        render: function (data, type, row) {
          /*neil 0214 新增功能*/
          return '<button class="black point"></button>'+(data.totalHosBLACK=='0'?'-':data.totalHosBLACK)+'<br><button class="red point"></button>'+(data.totalHosRED=='0'?'-':data.totalHosRED)+'<br><button class="orange point"></button>'+(data.totalHosORG=='0'?'-':data.totalHosORG)+'<br><button class="greenyellow point"></button>'+(data.totalHosGRE=='0'?'-':data.totalHosGRE)
        }
      }
    ],  
    columnDefs: [ { targets: '_all',className: 'text-center'},
    {targets: [0],orderable: true},
    {targets: [1],orderable: true},
    {targets: [2],orderable: true},
    /*neil 0213 修改為true*/
    {targets: [3],orderable: true},
    {targets: [4],orderable: false},
    {targets: [5],orderable: false},
    /*neil 0214 新增[6]*/
    {targets: [6],orderable: false},
   ], 
    data: hos_data,
} );
var data_table = document.getElementById('hos_table')
    data_table.style.width='100%';
document.getElementById('menu1').classList.add('displaynone')
}

function update_all() {
  if (pagination=='home') {case_table_renew(true)}
  else if(pagination=='station') {station_table_renew(true)}
  else {patient_table_renew(true)}
}


//case_table更新
function case_table_renew(update=false) {
  if (update==false) {
    date_datalist=JSON.parse(JSON.stringify(datalist));
    var i=0;
    while (i<date_datalist.length) {
      if (date_datalist[i].case_time < minDate | date_datalist[i].case_time > maxDate){
        date_datalist.splice(i, 1);
      }
      else {
        i++;
      }
    }
    present_datalist=JSON.parse(JSON.stringify(date_datalist));
    if (sel_county.value!='全部') {
      var i=0;
      while (i<present_datalist.length) {
        if ((present_datalist[i].case_county != sel_county.value )){
          present_datalist.splice(i, 1);
        }
        else {
          i++;
        }
      }
    }
    present_datalist_list=present_datalist.map(x => x.case_id);
  
    case_table.clear()
    case_table.rows.add(present_datalist)
    case_table.draw( false );
    case_table.page(0).draw( false );
  }
  else {
    $.post( api_CaseList, {"city_code":permission}).done(function( data ) {
      var currentPage = case_table.page()
      datalist=data.Data;
      date_datalist=JSON.parse(JSON.stringify(datalist));
      var i=0;
      while (i<date_datalist.length) {
        if (date_datalist[i].case_time < minDate | date_datalist[i].case_time > maxDate){
          date_datalist.splice(i, 1);
        }
        else {
          i++;
        }
      }
      present_datalist=JSON.parse(JSON.stringify(date_datalist));
      if (sel_county.value!='全部') {
        var i=0;
        while (i<present_datalist.length) {
          if ((present_datalist[i].case_county != sel_county.value )){
            present_datalist.splice(i, 1);
          }
          else {
            i++;
          }
        }
      }
      for (let i=0;i<present_datalist.length;i++){
        if (present_datalist_list.includes(present_datalist[i].case_id)){//修改
          case_table.row(present_datalist_list.indexOf(present_datalist[i].case_id)).data(present_datalist[i]).draw()
        }
        else {//新增
          case_table.rows.add([present_datalist[i]]).draw();
          present_datalist_list.push(present_datalist[i].case_id)
        }
      }
      var i=0;//刪除
      while (i<present_datalist_list.length) {
        if (present_datalist.map(x => x.case_id).includes(present_datalist_list[i]) != true) {
          present_datalist_list.splice(i,1);case_table.rows(i).remove().draw();
        }
        else {
          i++;
        }
      }
      case_table.page(currentPage).draw( false );
      timenow();
      sel_county_renew()
    })
  }
}



//station_table更新
function station_table_renew(update=false) {
  if (update==false) {
    console.log(stationdata);
    present_stationdata=JSON.parse(JSON.stringify(stationdata.station));
    var i=0;
    while (i<present_stationdata.length) {
      if ((present_stationdata[i].station_stime < station_minDate | present_stationdata[i].station_stime > station_maxDate) & present_stationdata[i].station_stime!=''){
        present_stationdata.splice(i, 1);
      }
      else {
        i++;
      }
    }
    present_stationdata_list=present_stationdata.map(x => x.station_num);
    station_table.clear()
    station_table.rows.add(present_stationdata)
    station_table.draw( false );
    station_table.page(0).draw( false );
  }
  else {
    $.post( api_station, {"case_id":case_id}).done(function( data ) {
      var currentPage = station_table.page()
      stationdata=data.Data;
      present_stationdata=JSON.parse(JSON.stringify(stationdata.station));
      var i=0;
      while (i<present_stationdata.length) {
        if ((present_stationdata[i].station_stime < station_minDate | present_stationdata[i].station_stime > station_maxDate) & present_stationdata[i].station_stime!=''){
          present_stationdata.splice(i, 1);
        }
        else {
          i++;
        }
      }

      for (let i=0;i<present_stationdata.length;i++){
        if (present_stationdata_list.includes(present_stationdata[i].station_num)){
          station_table.row(present_stationdata_list.indexOf(present_stationdata[i].station_num)).data(present_stationdata[i]).draw()
        }
        else {
          station_table.rows.add([present_stationdata[i]]).draw();
          present_stationdata_list.push(present_stationdata[i].station_num)
        }
      }
      var i=0;//刪除
      while (i<present_stationdata_list.length) {
        if (present_stationdata.map(x => x.station_num).includes(present_stationdata_list[i]) != true) {
          present_stationdata.splice(i,1);station_table.rows(i).remove().draw();
        }
        else {
          i++;
        }
      }
      station_table.page(currentPage).draw( false );
      timenow();
      update_statistics()//更新statistics左上角分析資料
      datapush() 
    })
  }
}



//patient_table更新
function patient_table_renew(update=false) {
  var state=[]
  var triage=[]
  if (filter_state.includes("select_onsite")) {state.push('現場')}
  if (filter_state.includes("select_enroute")) {state.push('送醫中')}
  if (filter_state.includes("select_arr")) {state.push('已到院')}
  if (filter_state.includes("")) {state.push('')}
  if (filter_triage.includes("select_org")) {triage.push('危險')}
  if (filter_triage.includes("select_ohca")) {triage.push('OHCA')}
  if (filter_triage.includes("select_red")) {triage.push('極危險')}
  if (filter_triage.includes("select_gre")) {triage.push('輕傷')}
  if (filter_triage.includes("")) {triage.push('')}
  if (update==false) {
    present_patientdata=JSON.parse(JSON.stringify(patientdata.patient));
    var i=0;
    while (i<present_patientdata.length) {
      if (triage.includes(present_patientdata[i].state.replace(" ",""))==false | state.includes(present_patientdata[i].loca.replace(" ",""))==false){
        present_patientdata.splice(i, 1);
      }
      else {
        i++;
      }
    }
    present_patientdata_list=present_patientdata.map(x => x.id);
    patient_table.clear()
    patient_table.rows.add(present_patientdata)
    patient_table.draw( false );
    patient_table.page(0).draw( false );
  }
  else {
    $.post( api_CaseDetail, {"case_id":case_id,"station_No":station_num}).done(function( data ) {
      var currentPage = patient_table.page()
      patientdata=data.Data
      present_patientdata=JSON.parse(JSON.stringify(patientdata.patient));
      var i=0;
      while (i<present_patientdata.length) {
        if (triage.includes(present_patientdata[i].state.replace(" ",""))==false | state.includes(present_patientdata[i].loca.replace(" ",""))==false){
          present_patientdata.splice(i, 1);
        }
        else {
          i++;
        }
      }
      
      for (let i=0;i<present_patientdata.length;i++){
        if (present_patientdata_list.includes(present_patientdata[i].id)){
          patient_table.row(present_patientdata_list.indexOf(present_patientdata[i].id)).data(present_patientdata[i]).draw()
        }
        else {
          patient_table.rows.add([present_patientdata[i]]).draw();
          present_patientdata_list.push(present_patientdata[i].id)
        }
      }
      var i=0;//刪除
      while (i<present_patientdata_list.length) {
        if (present_patientdata.map(x => x.id).includes(present_patientdata_list[i]) != true) {
          present_patientdata.splice(i,1);patient_table.rows(i).remove().draw();
        }
        else {
          i++;
        }
      }

      patient_table.page(currentPage).draw( false );
      timenow();
      update_statistics()//更新statistics左上角分析資料
      hos_table_renew()//hos_table更新
      datapush() 
      if (document.getElementById('myModal').style.display!='none') {myBtn(select_pid,true)}
      else if(document.getElementById('idfeature').style.display!='none') {feafun(select_pid)}
      else if(document.getElementById('myamrecord').style.display!='none') {record(select_pid)}
    })
  }
}





//hos_table更新
function hos_table_renew() {
  hos_data=[]
  var hos_list=[]
  //放值
  var hos_dataob_num={"hos":"","hos_level":"","hosspace":"","hosAllPeo":0,"goHos":{"goHosBLACK":0,"goHosRED":0,"goHosORG":0,"goHosGRE":0},"arrHos":{"arrHosBLACK":0,"arrHosRED":0,"arrHosORG":0,"arrHosGRE":0},"totalHos":{"totalHosBLACK":0,"totalHosRED":0,"totalHosORG":0,"totalHosGRE":0}}; 
  for (let i = 0;i<patientdata.patient.length;i++) { //Keys是將Object轉換成list[]
    if (patientdata.patient[i].hos!=""){
      if (hos_list.includes(patientdata.patient[i].hos)==false)  {   
        hos_list.push(patientdata.patient[i].hos)            //深淺拷貝轉換
        hos_data.push(JSON.parse(JSON.stringify(hos_dataob_num)))
        hos_data[hos_data.length-1]['hos']=patientdata.patient[i].hos;
        hos_data[hos_data.length-1]['hos_level']=patientdata.patient[i].hos_level;
        hos_data[hos_data.length-1]['hosspace']=patientdata.patient[i].hosspace;
      }
      var num = hos_list.indexOf(patientdata.patient[i].hos)

      //醫院收治總人數 
      hos_data[num]['hosAllPeo']+=1;
      //已到院
      if (patientdata.patient[i].state=="OHCA") {
        if (patientdata.patient[i].loca=="已到院") {hos_data[num].arrHos.arrHosBLACK+=1}
        else if (patientdata.patient[i].loca=="送醫中") {hos_data[num].goHos.goHosBLACK+=1}
        hos_data[num].totalHos.totalHosRED+=1
      }
      else if (patientdata.patient[i].state=="極危險") {
        if (patientdata.patient[i].loca=="已到院") {hos_data[num].arrHos.arrHosRED+=1}
        else if (patientdata.patient[i].loca=="送醫中") {hos_data[num].goHos.goHosRED+=1}
        hos_data[num].totalHos.totalHosRED+=1
      }
      else if (patientdata.patient[i].state=="危險") {
        if (patientdata.patient[i].loca=="已到院") {hos_data[num].arrHos.arrHosORG+=1}
        else if (patientdata.patient[i].loca=="送醫中") {hos_data[num].goHos.goHosORG+=1}
        hos_data[num].totalHos.totalHosORG+=1
      }
      else if (patientdata.patient[i].state=="輕傷") {
        if (patientdata.patient[i].loca=="已到院") {hos_data[num].arrHos.arrHosGRE+=1}
        else if (patientdata.patient[i].loca=="送醫中") {hos_data[num].goHos.goHosGRE+=1}
        hos_data[num].totalHos.totalHosGRE+=1
      }
    }
  }

  hos_table.clear()
  hos_table.rows.add(hos_data)
  hos_table.draw( false );
}



function sel_county_renew() {
  var sel_countyget=[]  //存放不重複的縣市
  var old_sel_countyget;
  var select_value=sel_county.value //原始選擇選像
  for(let i=0;i<date_datalist.length;i++) { //run案件資料
    if (sel_countyget.includes(date_datalist[i].case_county)==false & date_datalist[i].case_county!="") {
      sel_countyget.push(date_datalist[i].case_county)
    }
  }
  for (let i=0;i<county_order.length;i++)  {
    if (sel_countyget.includes(county_order[i])) {
      sel_countyget.push(sel_countyget.splice(sel_countyget.indexOf(county_order[i]),1)[0])
    }
  }
  old_sel_countyget = sel_county.innerText.split("\n")
  if (String(old_sel_countyget) != String(sel_countyget)) {
    $('.country_option').remove()
    for(let i=0;i<sel_countyget.length;i++) { //append排序後的縣市
      sel_county.innerHTML=sel_county.innerHTML+"<option value='" + sel_countyget[i] + "' class='country_option'>" + sel_countyget[i] + "</option>"
    }
    if(sel_countyget.includes(select_value)){
      sel_county.value = select_value;
    }
  }

}







function filt_case(){
  var st=document.getElementById('sdate').value;
  var et=document.getElementById('edate').value;
  minDate= st=="" ? '0000/00/00 00:00:00' : st.replaceAll('-','/') + ' 00:00:00';
  maxDate= et=="" ? '9999/99/99 99:99:99' : et.replaceAll('-','/') + ' 24:00:00';
  case_table_renew()
}



function filt_station(){
  var st=document.getElementById('station_sdate').value;
  var et=document.getElementById('station_edate').value;
  station_minDate= st=="" ? '0000/00/00 00:00:00' : st.replaceAll('-','/').replace('T'," ") + ':00';
  station_maxDate= et=="" ? '9999/99/99 99:99:99' : et.replaceAll('-','/').replace('T'," ") + ':99';
  station_table_renew()
}


function select_toggle(id) {
    if (id == "select_all_triage" & filter_triage.length!=5){
      document.getElementById("select_ohca").src="material/square_select_ohca_true.png";
      document.getElementById("select_red").src="material/square_select_red_true.png";
      document.getElementById("select_org").src="material/square_select_org_true.png";
      document.getElementById("select_gre").src="material/square_select_gre_true.png";
      filter_triage=['select_ohca','select_red','select_org','select_gre','']
    }
    else if(filter_triage.includes(id) & id != "select_all_triage") { 
      document.getElementById(id).src="material/Rectangle_" + id + "_false.png";
      filter_triage.splice(filter_triage.indexOf(id),1)
    } 
    else if (id != "select_all_triage") {
      document.getElementById(id).src="material/square_" + id + "_true.png";
      filter_triage.push(id);
    }
    if (filter_triage.length==4 & filter_triage.includes('')==false) {
      filter_triage=['select_ohca','select_red','select_org','select_gre','']
    }
    else if (filter_triage.length!=5 & filter_triage.includes('')) {
      filter_triage.splice(filter_triage.indexOf(''),1)
    }
    patient_table_renew()
}

function select_state(id) {
  if (id=='select_all' & filter_state.length!=3) {
    filter_state=["select_onsite",'select_enroute','select_arr']
    document.getElementById('select_onsite').classList.remove("unselect_state");
    document.getElementById('select_enroute').classList.remove("unselect_state");
    document.getElementById('select_arr').classList.remove("unselect_state");
    if (filter_state.length==3 & filter_state.includes('')==false) {
      filter_state=["select_onsite",'select_enroute','select_arr','']
    }
    else if (filter_state.length!=4 & filter_state.includes('')) {
      filter_state.splice(filter_state.indexOf(''),1)
    }
    patient_table_renew()
  }
  else if (id=='select_onsite' | id=='select_enroute' | id=='select_arr') {
    if (filter_state.includes(id)) {
      filter_state.splice(filter_state.indexOf(id),1)
      document.getElementById(id).classList.add("unselect_state");
    }
    else {
      filter_state.push(id);
      document.getElementById(id).classList.remove("unselect_state");
    }
    if (filter_state.length==3 & filter_state.includes('')==false) {
      filter_state=["select_onsite",'select_enroute','select_arr','']
    }
    else if (filter_state.length!=4 & filter_state.includes('')) {
      filter_state.splice(filter_state.indexOf(''),1)
    }
    patient_table_renew()
  }
}


//案件列表-案件狀態
function casestate_btn(cid) {
  case_id = cid;
  $('.station_page').css('display',''); 
  $('.patient_page').css('display','none'); 
  document.getElementById("APP").style.display = "none";
  document.getElementById('main_BNdiv').style.display = "block";
  document.getElementById("main_caselist").style.display = "none";
  document.getElementById("footer").style.display = "none";
  document.getElementById('casePushID').innerHTML=case_id;//大傷案號填入左上角
  pagination='station'
  station_table_init()
}


//點擊救護站
function station_btn(num) {
  station_num = num
  pagination='patient'
  $('.patient_page').css('display',''); 
  $('.station_page').css('display','none'); 
  //進入救護站之後移除station_table
  var patient_table_wrapper=document.getElementById('patient_table_wrapper')
  if (patient_table_wrapper!=null) {
    patient_table_wrapper.parentElement.removeChild(patient_table_wrapper)
  }
  var hos_table_wrapper=document.getElementById('hos_table_wrapper')
  if (hos_table_wrapper!=null) {
    hos_table_wrapper.parentElement.removeChild(hos_table_wrapper)
  }

  var table=document.createElement('table');
  table.id='patient_table';table.classList='display dtn-conrtol';
  document.getElementById('home').append(table)

  var tableh=document.createElement('table');
  tableh.id='hos_table';tableh.classList='display dtr-control dataTable no-footer';
  document.getElementById('menu1').append(tableh)
  patient_table_init()
}

function back_station_btn() {
  changepage('patient')
  pagination='station'
  $('.station_page').css('display',''); 
  $('.patient_page').css('display','none'); 
  var station_table_wrapper=document.getElementById('station_table_wrapper')
  if (station_table_wrapper!=null) {
    station_table_wrapper.parentElement.removeChild(station_table_wrapper)
  }
  var table=document.createElement('table');
  table.id='station_table';table.classList='display dtn-conrtol';
  document.getElementById('station_content').append(table)
  station_table_init()
}





//大傷push資料至左上角
function update_statistics() {
  if (pagination == 'station'){
  //大傷案件
  document.getElementById('casePushNAME').innerHTML=stationdata.case_name;
  //大傷開案時間
  document.getElementById('casePushTIME').innerHTML=stationdata.case_time.slice(stationdata.case_time.search('/')+1);
  //大傷案發縣市
  document.getElementById('casePushCOUNTY').innerHTML=stationdata.case_county;
  //大傷目前狀態
  document.getElementById('casePushSTATE').innerHTML=stationdata.case_state;
  //大傷案發時間
  document.getElementById('casePushCASETIME').innerHTML=stationdata.cs_startime.slice(stationdata.cs_startime.search('/')+1);
  }
  else {
  //大傷案件
  document.getElementById('casePushNAME').innerHTML=patientdata.case_name;
  //大傷開案時間
  document.getElementById('casePushTIME').innerHTML=patientdata.case_time.slice(patientdata.case_time.search('/')+1);
  //大傷案發縣市
  document.getElementById('casePushCOUNTY').innerHTML=patientdata.case_county;
  //大傷目前狀態
  document.getElementById('casePushSTATE').innerHTML=patientdata.case_state;
  //大傷案發時間
  document.getElementById('casePushCASETIME').innerHTML=patientdata.cs_startime.slice(patientdata.cs_startime.search('/')+1);
  //救護站名
  document.getElementById('stationPushNAME').innerHTML=patientdata.station_name;  
  }
}






//切換分頁
function changepage(pageid) {
  if (pagination!=pageid) {
    pagination=pageid;
    $('.nav-item').removeClass('nav-item_selected')
    document.getElementById(pageid).classList.add("nav-item_selected");
    $('.changepage').addClass('displaynone')
    if (pageid=='patient') {home.classList.remove('displaynone')}
    else if (pageid=='hos') {menu1.classList.remove('displaynone')}
  }
}




function datapush() { //push表格資料
  if (pagination == 'station'){
    let tot=parseInt(stationdata.station[0].station_totpeo.black)+parseInt(stationdata.station[0].station_totpeo.red)+parseInt(stationdata.station[0].station_totpeo.orange)+parseInt(stationdata.station[0].station_totpeo.green)
    document.getElementById('pushgary_data').innerHTML=String(tot)
    document.getElementById('pushohca_data').innerHTML=String(stationdata.station[0].station_totpeo.black);
    document.getElementById('pushred_data').innerHTML=String(stationdata.station[0].station_totpeo.red);
    document.getElementById('pushorg_data').innerHTML=String(stationdata.station[0].station_totpeo.orange);
    document.getElementById('pushgre_data').innerHTML=String(stationdata.station[0].station_totpeo.green);
    
    
    //colordata百分比
    document.getElementById('pushrog_value').innerHTML=tot==0 ? '_' : String(((parseInt(stationdata.station[0].station_totpeo.red)+parseInt(stationdata.station[0].station_totpeo.orange)+parseInt(stationdata.station[0].station_totpeo.green))/tot*100).toFixed(1));
    document.getElementById('pushohca_value').innerHTML=tot==0 ? '_' : String((parseInt(stationdata.station[0].station_totpeo.black)/tot*100).toFixed(1));
    //總送醫百分比
    let pushenroute=parseInt(stationdata.station[0].station_rouhos.black)+parseInt(stationdata.station[0].station_rouhos.red)+parseInt(stationdata.station[0].station_rouhos.orange)+parseInt(stationdata.station[0].station_rouhos.green)
    let pusharrive=parseInt(stationdata.station[0].station_inhos.black)+parseInt(stationdata.station[0].station_inhos.red)+parseInt(stationdata.station[0].station_inhos.orange)+parseInt(stationdata.station[0].station_inhos.green)
    let pushnothos=parseInt(stationdata.station[0].station_nohos.black)+parseInt(stationdata.station[0].station_nohos.red)+parseInt(stationdata.station[0].station_nohos.orange)+parseInt(stationdata.station[0].station_nohos.green)
    document.getElementById('pushtotal_value').innerHTML=tot==0 ? '_' : String(((pushenroute+pusharrive)/tot*100).toFixed(1));
    //傷患後送數據
    //傷患後送數據-後送中人數
    document.getElementById('pushenroute_value').innerHTML=String(pushenroute);
    document.getElementById('pushenroute_p').innerHTML=tot==0 ? '_' : String((pushenroute/tot*100).toFixed(1));

    document.getElementById('pushenroute_valuepho').innerHTML=String(pushenroute);
    document.getElementById('pushenroute_ppho').innerHTML=tot==0 ? '_' : String((pushenroute/tot*100).toFixed(1));
    //傷患後送數據-到院人數
    document.getElementById('pusharrive_value').innerHTML=String(pusharrive);
    document.getElementById('pusharrive_p').innerHTML=tot==0 ? '_' : String((pusharrive/tot*100).toFixed(1));

    document.getElementById('pusharrive_valuepho').innerHTML=String(pusharrive);
    document.getElementById('pusharrive_ppho').innerHTML=tot==0 ? '_' : String((pusharrive/tot*100).toFixed(1));
    //傷患後送數據-未送醫人數
    document.getElementById('pushnothos_value').innerHTML=String(pushnothos);
    document.getElementById('pushnothos_p').innerHTML=tot==0 ? '_' : String((pushnothos/tot*100).toFixed(1));

    document.getElementById('pushnothos_valuepho').innerHTML=String(pushnothos);
    document.getElementById('pushnothos_ppho').innerHTML=tot==0 ? '_' : String((pushnothos/tot*100).toFixed(1));
    //傷患後送數據-後送車輛數
    document.getElementById('pusharrve_value').innerHTML=stationdata.cartotal;
    document.getElementById('pusharrveh_valuepho').innerHTML=stationdata.cartotal;
  }
  else{
    //colordata
    document.getElementById('pushgary_data').innerHTML=patientdata.patient.length;
    var stat=[0,0,0,0]; //檢傷人數
    var enroute_value = 0;//傷患後送數據-後送中人數
    var arrive_value = 0;//傷患後送數據-到院人數
    var nothos_value = 0; //傷患後送數據-未送醫人數
    var unik=[] //傷患後送數據-後送車輛數
    for(let i=0;i<patientdata.patient.length;i++)
    {
      if (patientdata.patient[i].state=="OHCA") {stat[0]+=1}
      else if (patientdata.patient[i].state=="極危險") {stat[1]+=1}
      else if (patientdata.patient[i].state=="危險") {stat[2]+=1}
      else if (patientdata.patient[i].state=="輕傷") {stat[3]+=1}

      if (patientdata.patient[i].loca.replace(" ","")=="送醫中"){ enroute_value+=1 }
      if (patientdata.patient[i].loca.replace(" ","")=="已到院"){ arrive_value+=1 }
      if (patientdata.patient[i].loca.replace(" ","")=="現場"){ nothos_value+=1 }
      if (unik.includes(patientdata.patient[i].car)==false & patientdata.patient[i].car!="") {
        unik.push(patientdata.patient[i].car) //將car push到unik陣列
      }
    }
    document.getElementById('pushohca_data').innerHTML=String(stat[0]);
    document.getElementById('pushred_data').innerHTML=String(stat[1]);
    document.getElementById('pushorg_data').innerHTML=String(stat[2]);
    document.getElementById('pushgre_data').innerHTML=String(stat[3]);
    //colordata百分比
    document.getElementById('pushrog_value').innerHTML=patientdata.patient.length==0 ? '_' : String(((stat[1]+stat[2]+stat[3])/patientdata.patient.length*100).toFixed(1));
    document.getElementById('pushohca_value').innerHTML=patientdata.patient.length==0 ? '_' : String((stat[0]/patientdata.patient.length*100).toFixed(1));
    //總送醫百分比
    document.getElementById('pushtotal_value').innerHTML=patientdata.patient.length==0 ? '_' : String(((enroute_value+arrive_value)/patientdata.patient.length*100).toFixed(1));
    //傷患後送數據
    //傷患後送數據-後送中人數
    document.getElementById('pushenroute_value').innerHTML=String(enroute_value);
    document.getElementById('pushenroute_p').innerHTML=patientdata.patient.length==0 ? '_' : String((enroute_value/patientdata.patient.length*100).toFixed(1));

    document.getElementById('pushenroute_valuepho').innerHTML=String(enroute_value);
    document.getElementById('pushenroute_ppho').innerHTML=patientdata.patient.length==0 ? '_' : String((enroute_value/patientdata.patient.length*100).toFixed(1));
    //傷患後送數據-到院人數
    document.getElementById('pusharrive_value').innerHTML=String(arrive_value);
    document.getElementById('pusharrive_p').innerHTML=patientdata.patient.length==0 ? '_' : String((arrive_value/patientdata.patient.length*100).toFixed(1));

    document.getElementById('pusharrive_valuepho').innerHTML=String(arrive_value);
    document.getElementById('pusharrive_ppho').innerHTML=patientdata.patient.length==0 ? '_' : String((arrive_value/patientdata.patient.length*100).toFixed(1));
    //傷患後送數據-未送醫人數
    document.getElementById('pushnothos_value').innerHTML=String(nothos_value);
    document.getElementById('pushnothos_p').innerHTML=patientdata.patient.length==0 ? '_' : String((nothos_value/patientdata.patient.length*100).toFixed(1));

    document.getElementById('pushnothos_valuepho').innerHTML=String(nothos_value);
    document.getElementById('pushnothos_ppho').innerHTML=patientdata.patient.length==0 ? '_' : String((nothos_value/patientdata.patient.length*100).toFixed(1));
    //傷患後送數據-後送車輛數
    document.getElementById('pusharrve_value').innerHTML=String(unik.length);
    document.getElementById('pusharrveh_valuepho').innerHTML=String(unik.length);
  }
 
} 


/*list2表格*/


/*最後更新時間*/
function timenow() {
    var date = new Date;
    var str="";
    str += date.getHours()<12?"上午 ":"下午 ";
    str += ('0' + date.getHours()).slice(-2) + ' : ' + ('0' + date.getMinutes()).slice(-2) + ' : ' + ('0' + date.getSeconds()).slice(-2);
    document.getElementById('timenow').innerHTML=str;
}






//特徵照片qqqq
function myBtn(id,update=false) {
  select_pid=id;
  //先透過id抓資料跑迴圈後載入圖片
  var data_temp;
  var largepicchoosediv = document.getElementById('largepicchoosediv')
  for(let i=0;i<present_patientdata.length;i++) {
    if (present_patientdata[i].id==id){
      data_temp=present_patientdata[i]
      break
    }
    if (i==present_patientdata.length-1){
      alert('error,找不到data,還請您重新整理')
      continue
    }
  }
  document.getElementById("myModal").style.display = "block";
  document.getElementById("hide").style.display = "block";
  //push大圖
  if (update==false) {
    largepicchoosediv.innerHTML=""
    if (data_temp.pho.length!=0) {
      document.getElementById('largepicdiv').innerHTML='<img src="' + data_temp.pho[0] + '" id="delphobig" onclick="enlarge_mainphoto()">'
    }
    else {
      document.getElementById('largepicdiv').innerHTML='<img src="material/nodata.png" id="delphobig" onclick="enlarge_mainphoto()">'
    }
  }
  if (document.getElementById('delphobig').src.includes("nodata.png") & data_temp.pho.length!=0) {
    document.getElementById('largepicdiv').innerHTML='<img src="' + data_temp.pho[0] + '" id="delphobig" onclick="enlarge_mainphoto()">'
    }

  //特徵照片button迴圈
  //增加
  for(let i=0;i<data_temp.pho.length;i++) {
    if (largepicchoosediv.innerHTML.includes(data_temp.pho[i])==false) {
      var img=document.createElement('img');
      img.src=data_temp.pho[i];img.setAttribute('onclick', 'chmainphoto("' + data_temp.pho[i] + '")');
      largepicchoosediv.appendChild(img)
    }
  }
  //減少
  for (let i=0;i<largepicchoosediv.childElementCount;i++) {
    var rmimg=largepicchoosediv.children[i]
    if (data_temp.pho.includes(rmimg.src)==false){
      largepicchoosediv.removeChild(rmimg)
    }
  }
}
  
//救護紀錄
function record(id) {
  select_pid=id;
  //先透過id抓資料跑迴圈後載入PDF
  var data_record;
  var recorddata
  for(let i=0;i<present_patientdata.length;i++)
  {
    if (present_patientdata[i].id==id){
      data_record=present_patientdata[i]
      break
    }
    if (i==present_patientdata.length-1){
      alert('error,找不到data,還請您重新整理')
    }
  }
  document.getElementById("myamrecord").style.display = "block";
  recorddata=!data_record.recor ? '<img src="material/nodata.png">' : '<iframe src="' + data_record.recor + '" id="delpdf"></iframe>'
  if (document.getElementById("record").innerHTML!=recorddata) {
    document.getElementById("record").innerHTML=recorddata;
  }
}

//傷患資料
function feafun(id) {
  select_pid=id;
  var data_fea;
  for(let i=0;i<present_patientdata.length;i++)
  {
    if (present_patientdata[i].id==id){
      data_fea=present_patientdata[i]
      break
    }
    if (i==present_patientdata.length-1){
      alert('error,找不到data,還請您重新整理')
      continue
    }
  }
  document.getElementById("idfeature").style.display = "block";
  //傷患評估
  //傷患資料-身分證ID
  document.getElementById('injeveID').innerHTML=data_fea.id;
  //傷患資料-NAME
  document.getElementById('injeveNAME').innerHTML=data_fea.name;
  //傷患資料-PHONE
  document.getElementById('injevePHONE').innerHTML=data_fea.injevePHONE;
  //傷患資料-SEX
  document.getElementById('injeveSEX').innerHTML=data_fea.sex;
  //傷患資料-AGE
  document.getElementById('injeveAGE').innerHTML=data_fea.age;
  //特徵說明
  document.getElementById('sittop').innerHTML=data_fea.featureR;
  //補充說明
  document.getElementById('sitdown').innerHTML=data_fea.featureRD;
}


//patient_table-窗體外關閉視窗
function hidebox(id){
  document.getElementById(id).style.display='none';
  document.getElementById('hide').style.display='none';
}



//patient_table-特徵照片
function enlarge_mainphoto(){
  var src;
  for (let i=0; i<document.getElementById('largepicdiv').children.length;i++) {
    if (document.getElementById('largepicdiv').children[i].src!='') {
      src=document.getElementById('largepicdiv').children[i].src
      break
    }
  }
  var div= document.createElement("div");
  div.id="hide1"
  div.innerHTML='<img src="' + src + '">' ;
  div.setAttribute('onclick', 'rmdiv()');
  document.getElementById("body").append(div);
}

//窗體外關閉視窗
function rmdiv(id='hide1'){
  var del=document.getElementById(id)
      del.parentElement.removeChild(del)
}

//切換主要照片
function chmainphoto (url) {
  var delphobig=document.getElementById('delphobig');
  delphobig.src=url
}

//回到選擇系統
function gologout() {
	  window.location.href='${redirect}/relogin?token=${token}';
}


    </script>
</body>
</html>