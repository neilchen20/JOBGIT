<!DOCTYPE html>  
<!--深拷貝(deep copy)=會copy一樣的object 值不會影響  /  淺拷貝(shallow copy)=值會互相影響
    Datatables noresponsive的原因是沒有load到code 因打開網頁code只執行一次, so 解決方法是重新load-->


<!--xxtable.row.add(放新data).draw(false); if多筆資料要add.row加s
新資料進來後 先過濾掉present_patientdata舊有的資料(重複) 會得到新資料 再row.add(xx).draw(false)
刪除 
-->
<!--XXtable.row(tr).data(放data).draw(false); 覆蓋舊資料
xxtable.row(xx).remove().draw(false);-->
<!--檔案刪除4.jpeg,6.jpg,2022-2.jpeg,2022.jpg,indexcopy.html,case.html,index_header.html,icon.ico-->
<html lang="tw">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><!--指示瀏覽器如何控制網頁的大小和縮放-->
    <script src="js/jquery-3.5.1.min.js"></script>
    <script src="js/1.12.1jquery.dataTables.min.js"></script>
    <script src="js/2.3.0dataTables.responsive.min.js"></script>
    <link rel="stylesheet" href="css/dataTable.css">
    <link rel="stylesheet" href="css/responsive.dataTables.min.css">
    <link rel="shortcut icon" href="material/icon.ico">
    <title>大量傷病患救護管理系統</title>
    <style>
*{font-size: x-large;font-weight: bold;margin:0;padding:0;list-style:none;text-decoration:none;box-sizing: border-box;user-select: none;font-family: myFirstFont;}
.left{float:left}.right{float:right}.text_right{text-align:right}               
html{height: auto;width: 100%;background-color: #d2ecfa;}                                    /*neil 0921 新增*/                                       
body{height: auto;width: 100%;background-color: #d2ecfa6a;background-repeat-y:no-repeat;background-image: url('material/bg_head.png');background-repeat: repeat-x;}
header{position: relative;width: 100%;height: 100px;padding: 5px 1%;}
main{width: 100%;height: 90%;position: relative;    margin-top: 20px;display: flex;}
#home{background-color: white;padding-top: 10px;}/*neil 0921 新增*/
@media (max-width: 940px){
  * {font-size: medium;}
  header{height: 75px;}
  /*neil 0921 新增 #ondata # indatarwd fontsize*/
  #ondata{position: absolute;width: 20%;display: inline-flex;color:rgb(16, 98, 199);font-size: large;}
  #indatarwd{width: 100%;height: 30px;position: relative;display: inline;color:rgb(16, 98, 199);margin-top: 10px;font-size: large;} /*neil 0920 新增color margin 修改width height 移除text-align writing mode*/
  .select_state{font-size: small;}
  /*neil 0923 ^^^^ 上三行*/
}
@media (max-width: 780px){
  main{margin-top: 0px;}
}
/*主頁上方標題*/
#logodiv{display: inline; height: 100%;}
#rwdlogo{position: relative;top: 10%;height: 100%;}
#timeid{display: flex;align-items: center;height: 100%;margin-right:2% ;font-size: large;}
#caselist{height: 70%;top: 15%;margin-right:1%;width: 9%;cursor: pointer;}
#logout{height: 70%;top: 15%;margin-right:2% ;width: 12%}
.custom-btn {font-size: 1.8vw;white-space: nowrap;color: #fff;padding: 10px 25px;font-family: 'Lato', sans-serif;font-weight: 900;  font-style: normal;text-shadow: 0px -1px 0px rgba(0,0,0,0.4);text-decoration: none;position: relative;display: flex;box-shadow: inset 0px 1px 0px rgba(255,255,255,1),0px 1px 3px rgba(0,0,0,0.3);outline: none;border: 1px solid #ba6;    border-color: #96C6CF;background: #5EA1A9;border-radius: 5px;align-items: center;justify-content: center;}
.custom-btn:active{  -webkit-transform: translateY(2px);  transform: translateY(2px);}
#dateperiod{margin-right: 8%;}
@media (max-width: 720px)
{
  /*主頁上方標題*/
  header{position: relative;width: 100%;height: auto;display: inline-block;}
  #logodiv{display: inline; width: 100%;    height: auto;}
  #rwdlogo{position: relative;height: auto;width: 100%;}
  #timeid{display: flex;align-items: center;height: 100%;margin-left:2% ;font-size: large;}
  .custom-btn {font-size: 15px;}
  #dateperiod{margin-right: 0%;}
  #caselist{width: auto;}
  #logout{width: auto;}
}


#main_caselist{display: block;position: relative;width: 100%;height: auto;z-index: 1;margin-bottom: 30%;} /*neil 0921 修正margin-bot*/
#main_BNdiv{display: none;width: 100%;height: 100%;top: 10px;position: relative;}

/*neil 0920 新增 下四行*/
.sedate{margin: 0px 20px 0px 20px;}
#edate{margin-right: 25px;}
#sel_county{margin-left: 10px;}
#select_ohca{margin-left: 10px;} 
/*neil 0923 ＾＾＾＾ 上四行*/

/*maintable*/
/*neil 0921 移除.dataTables_wrapper{background-color: white;}*/
.dataTable thead{color: white;}
.dataTables_length label{color: rgb(0, 0, 0);}  /*neil 0921 改色*/
.dataTables_length select{color: rgb(0, 0, 0);background-color: white !important;}/*neil 0921 改色*/
.dataTables_info{color: rgb(0, 0, 0) !important;}/*neil 0921 改色*/
.dataTables_filter label{color: rgb(0, 0, 0);}/*neil 0921 改色*/
#main_table{position: relative;width: 90%;margin-left: 5%;height: auto;top: 10px;}
.display{text-align: center;background-color: #5EA1A9;}
.display  tbody tr:nth-child(odd){background-color: #F4EFDC;}
.state_but_div{display: flex;justify-content: center;}
.state_but{cursor: pointer;white-space: nowrap;color: #fff;padding: 5px 10px;font-family: 'Lato', sans-serif;font-weight: 900;  font-style: normal;text-shadow: 0px -1px 0px rgba(0,0,0,0.4);text-decoration: none;position: relative;display: flex;box-shadow: inset 0px 1px 0px rgba(255,255,255,1),0px 1px 3px rgba(0,0,0,0.3);outline: none;border: 1px solid #ba6;border-color: #7c7c7c;background: #0679D2;border-radius: 50px;align-items: center;justify-content: center;}


#footer{position: fixed;height: 12vh;width: 100%;bottom: 0;z-index: 0;background-image: url(material/bg_blue.png);display: flex;align-items: flex-end;background-size: 100% 100%;}
#bg_peo{position:relative;bottom: 0;height: 160%;;margin-left: 2%;}
#bg_add{position:relative;bottom:10%;height: 20%;margin-left: 2%;}


#container{position: relative;width: 100%;height: auto;margin-top: 10px;}
#indatabox_s{display: none;}
#tab-content{width: 85%;height: auto;position: relative;margin-left: 1%;margin-top: 10px;margin-bottom: 5%;}
#indatarwd{width: 100%;height: 30px;position: relative;display: inline;color:rgb(16, 98, 199);margin-top: 10px;} /*neil 0920 新增color margin 修改width height 移除text-align writing mode*/
#indata_all{width: 100%;height: 80%;} /*neil 0921*/
#pagediv{position: relative;width: calc(100% - 20px);margin-left: 20px;display: flex;}
.nav-item{margin-right: 10px;box-shadow: 0px 0px 3px rgb(149 149 149);width: 200px;height: 65px;display: flex;justify-content: center;align-items: center;color: #0d6efd;background-color: rgb(185,221,252);border-radius: 10px;} /*neil 0921 新增*/
.nav-item:hover {box-shadow: 0 8px 12px 0 rgba(0,0,0,0.2);}
.nav-item_selected{color: black;background-color: rgb(113,185,255);}/*neil 0920 修改頁籤按鈕背景*/
.actived{background-color: #fff;    color: #495057;}
#indatabox_l{position: fixed;right: 0;width: 13%;padding-right: 1%;height: 65%;}        /*neil 0921 修改背景色、邊框色*/
.indatabox_l_box{display: flex;align-items: center;border-radius: 10px;background-color: white;border: 2px solid #dddddd;box-shadow: 5px 5px 5px lightblue;height: 15%;margin-top: 5%;}
.indatabox_l_box_icon{height: 100%;display: flex;align-items: center;margin-left: 5%;width: 25px;}
.indatabox_l_box_icon img{width:25px;height:25px;}
.indatabox_l_value{text-align: right;font-size: 1.3vw;width: calc(90% - 25px);}
.indatabox_l_value_s{text-align: right;font-size: small;width: calc(90% - 25px);}/*neil 0923 font-size修改*/
.green{color: rgb(39,140,86);}
@media (max-width: 650px){
  .nav-item{width: 170px;height: 50px;font-size: large;} /*neil 0921 新增fontsize*/
/*neil 0923 新增 下7行*/
  .sedate{margin: 0px 2% 10px 0px;}
  #edate{margin-left: 21%;}
  #date{margin-left:2%}
  #county{float: left;margin: 0px 0px 10px 2%;}
  #sel_county{margin-left: 0;}
  #ondata{position: absolute;width: 20%;display: inline-flex;color:rgb(16, 98, 199);font-size: large;}
  #indatarwd{width: 100%;height: 30px;position: relative;display: inline;color:rgb(16, 98, 199);margin-top: 10px;font-size: large;} /*neil 0920 新增color margin 修改width height 移除text-align writing mode*/
/*neil 0923 上7行 ^^^^^^^^*/
}
/*neil 0920 新增 media380px*/
@media (max-width:380px) {
  .sedate{margin:0;}
  #sdate{margin: 0px 2% 10px 0px;}
  #edate{margin-left: 21.9%}
  #date{margin-left:2%}
}

@media (max-width: 1305px){
  #tab-content {width: 90%;margin-left: 5%;}               /*neil 0921 修改margin-left*/
  #indatabox_s{position: relative;width: 90%;height: 200px;margin-left: 8%;display: flex;flex-direction: column;}/*neil 0921 新增 flex-d*/  
  /*neil 0921 修改margin border padding width 新增bakgro-color*/                                                                   
  .indatabox_s_box{display: flex;align-items: center;padding: 3px;position: relative;width:43%;margin-left: 3%;height: calc(50% - 20px);margin-top: 10px;
    text-align: center;border: 2px solid #dddddd;border-radius: 5px;box-shadow: 5px 5px 5px lightblue;background-color: white;}
  #indatabox_l{display: none;}
}

/*案號*/
#statistics{margin-left: 1%;position: relative;width: 40%;display: inline-block;}
.lstatistics{position: relative;width: 60%;display: inline-block;height: 30px}
.rstatistics{position: relative;width: 40%;display: inline-block;height: 30px;}
.ststatistics{width: 100%;}
#colordata{position: relative;right:0;width: 58%;background-color: rgb(255, 255, 255);background-color: #d2ecfa;}
#colorcube{position: relative;display: flex;}
#onsitedata{position: relative;margin-top: 20px;width: 99%;max-width: 880px;display: flex;justify-content: space-between;}
.cube{display: flex;position: relative;margin-left: 2%;width: 16.5%;height: 50px;border-radius: 10px;align-items: center;justify-content: center;}
#ondata{position: absolute;width: 20%;display: inline-flex;color:rgb(16, 98, 199);}
.anvalue{position: relative;display: inline;}
@media (max-width: 1305px){      /*neil 0921 修改margin-left width*/
  #colordata{position: relative;width: 82%;height: 100px;margin-top: 15px;margin-left:8%;display: inline-table;}
  #statistics {position: relative;width: 80%;height: 80px;margin-left: 10%;}
  #onsitedata{width: 100%;height: 60px;display: block;}
  .cube{height: 40px;}
  #ondata{position: absolute;width: 20%;display: inline-flex;color:rgb(16, 98, 199);}
  /*neil 0921 修改width*/
  .anvalue{width: 70%;float: right;display: flex;align-items: flex-end;justify-content: flex-end;line-height: 1;margin: 8px 0px 7px 0px;}/*neil 0921 新增line-hei margin*/
}
@media (max-width: 600px){
  #statistics {width: 95%; margin-left: 5%;}
  #ondata{width: 25%;color:rgb(16, 98, 199);}
}
#gray{color: white;background-color: rgb(180, 191, 196);}
/*OHCA*/.black{color: white;background-color: rgb(59,59,59);}
/*極危險*/.red{background-color: rgb(224, 97, 111);}
/*危險*/.orange{background-color: rgb(244, 210, 57);}
/*輕傷*/.greenyellow{background-color: rgb(128, 185, 90);}


/*colordata-colorbutton*/        /*neil 0920 修改padding border-radius margin 新增vertical-align*/
.point {position: relative;border: none;padding: 7px 7px;margin: 0px 5px 1px 10px;border-radius: 3px;cursor: default;vertical-align: super}

.value{position: relative;width:auto;top: 60px;left: 40%;font-weight: bolder;}
.ohcavalue{position: relative;left: 15%;width: auto;top: 60px;font-weight: bolder;}
.total{position: relative;left: 71%;width: auto;top: 60px;font-weight: bolder;}


/*main*/
.displaynone{display: none;}
.triage{display: inline-block;padding: 5px 10px;border-radius: 5px;}
.greenttriage {background-color: rgb(128, 185, 90);}
.orangettriage {background-color: rgb(244, 210, 57);}
.redttriage {background-color: rgb(224, 97, 111);} 
.ohcattriage {background-color: rgb(59, 59, 59);color: #f1f1f1;}

/******0831 15:15--- 移除現場數據色塊 hover*/
#selectBTN{position: relative;width: 100%;height: 40px;}
#selectL{width: 50%;height: 30px;display: inline-block;display: flex;justify-content: flex-end;}
#selectR{width: 49%;height: 30px;display: inline-block;display: flex;justify-content: flex-end;}
.select_triage{margin-right: 3%;cursor: pointer;height: 100%;}


#select_all {transition: all 0.8s;overflow: hidden;cursor: pointer;}
#select_all:after {content: "";background: white;display: block;position: absolute;padding-top: 300%;padding-left: 300%;margin-left: -20px!important;margin-top: -120%;opacity: 0;transition: all 0.8s;border-radius: 10px;}
#select_all:active:after {padding: 0;margin: 0;opacity: 1;transition: 0s}
.select_state{color: white;background-image: linear-gradient(to right, #005fe0 0%, #0099b9 100%);border-radius: 10px;width: auto;margin-right: 3%;font-size: large;padding: revert;position: relative;cursor: pointer;}
.unselect_state{background-image: none;color: rgb(104 104 104);}


@media (max-width: 700px){
  #selectBTN {height: 80px}
  #selectL{width: 100%;line-height: 2;}
  #selectR{width: 100%;margin-top: 15px;margin-bottom: 10px;}
}










/*list2-title*/
#list2div{position: relative;width: 100%;}
/*傷患後送數據*/
#straight{font-weight: bolder;font-size: larger;display: flex;justify-content: center;font-size: 1.9vw;color:rgb(16, 98, 199);}/*neil 0920 新增color*/


.enroutebtn {display: inline-block;border-radius: 4px;background-color: #0000;border: 2px solid #8fccf1;
  box-shadow: 5px 5px 5px lightblue;color: rgb(0, 0, 0);text-align: left;padding: 15px 5px 15px 5px;width: 90%;transition: all 0.5s;cursor: pointer;}
.arrivebtn {display: inline-block;border-radius: 4px;background-color: #0000;border: 2px solid #8fccf1;
  box-shadow: 5px 5px 5px lightblue;color: rgb(0, 0, 0);text-align: left;padding: 15px 5px 15px 5px;width: 90%;transition: all 0.5s;cursor: pointer;}
.arrivebtn span {cursor: pointer;display: inline-block;position: relative;transition: 0.5s;color:rgb(94,154,107)}
.arrivebtn span:after {content: '\00bb';position: absolute;opacity: 0;top: 0;right: -20px;transition: 0.5s;}
.arrivebtn:hover span {padding-top: 5px;font-size: 18px;}
.nothosbtn {display: inline-block;border-radius: 4px;background-color: #0000;border: 2px solid #8fccf1;
  box-shadow: 5px 5px 5px lightblue;color: rgb(0, 0, 0);text-align: left;padding: 15px 5px 15px 5px;width: 90%;transition: all 0.5s;cursor: pointer;}
.nothosbtn span {cursor: pointer;display: inline-block;position: relative;transition: 0.5s;color:rgb(94,154,107)}
.nothosbtn span:after {content: '\00bb';position: absolute;opacity: 0;top: 0;right: -20px;transition: 0.5s;}
.nothosbtn:hover span {padding-top: 5px;font-size: 18px;}
.arrvehbtn {display: inline-block;border-radius: 4px;background-color: #0000;border: 2px solid #8fccf1;
  box-shadow: 5px 5px 5px lightblue;color: rgb(0, 0, 0);text-align: left;padding: 15px 5px 15px 5px;width: 90%;transition: all 0.5s;cursor: pointer;}
.arrvehbtn span {cursor: pointer;display: inline-block;position: relative;transition: 0.5s;color:rgb(94,154,107)}
.arrvehbtn span:after {content: '\00bb';position: absolute;opacity: 0;top: 0;right: -20px;transition: 0.5s;}
.arrvehbtn:hover span {padding-top: 5px;font-size: 18px;}
#none{display: none;}
.tablehide{display: none;}
.inbr{display:block;}













/*list1特徵照片*/
#myModal {display: none;position: fixed;z-index: 1;padding-top: 70px;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0,0,0);background-color: rgba(0, 0, 0, 0.251);}
#modal-content {background-color: #fefefe;border: 1px solid #888;width: 80%;height: 80%;top: 10%;left: 10%;position: absolute;}
#largepicchoosediv{position: absolute;top: 80%;height: 10%;min-height: 55px;left: 25%;width: 50%;overflow-y: hidden;display: flex;box-shadow: 0px 0px 5px black;}
#largepicchoosediv img{max-height: 100%;max-width: 100%;width: auto;height: auto;margin-right: 10pt;top: 0;cursor: pointer;}
#largepicdiv{position: absolute;height: 65%;top: 10%;left: 15%;width: 70%;display: flex;}
#largepicdiv img{max-height: 100%;max-width: 100%;margin: auto;}
#delpdf{border-style: none;height: 100%;width: 100%;}
.scrollho::-webkit-scrollbar-track{background-color: rgba(0,0,0,0);border-radius: 10px;}
.scrollho::-webkit-scrollbar{width: 13px;background-color: rgba(0,0,0,0);}
.scrollho::-webkit-scrollbar-thumb{border-radius: 10px;    background-image: -webkit-gradient(linear,right bottom, left top, color-stop(0.44, rgb(208 215 229)), color-stop(0.72, rgb(155 192 240)), color-stop(0.86, rgb(133 162 246)));}

#largepicchoosediv{position: absolute;top: 80%;height: 10%;left: 25%;width: 50%;overflow-y: hidden;display: flex;box-shadow: 0px 0px 5px black;}

/*list1救護紀錄*/
#myamrecord {display: none;position: fixed;z-index: 1;padding-top: 100px;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0,0,0);background-color: rgba(0,0,0,0.4);}
#amrecord-content {background-color: #fefefe;width: 80%;left: 10%;height: 80%;top: 10%;position: absolute;}
#record{display: flex;justify-content: center;align-items: center;position: absolute;height: 90%;top: 5%;width: 80%;left: 10%;}
#record img{max-height: 90%;}








/*list1傷患資料*/
.feature {display: none;position: fixed;z-index: 1;padding-top: 100px;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0,0,0);background-color: rgba(0,0,0,0.4);}
#feature-content {background-color: #fefefe;margin: auto;padding: 1%;border: 1px solid #888;width: 60%;height: 80%;}
#situation{position: relative;padding: 15px;width: 100%;height: 100%;border-radius: 10px;border: 2px solid #b7b7b7;}
#sitone{width: 25%;height: 100%;position: relative;}
#sittitle{color: #1075fa;font-size: x-large;}
.injeveAId{display: inline-flex;margin-top: 15px;font-size: x-large;}
.injeveAId_text{font-size: large;}
#sitline{height:95%;width:75%;position: relative;border-left-style:groove}
/*list1傷患資料-特徵說明*/
.sittoptitle{position: relative;left: 20px;color: #1075fa}
.sitright{position: relative;width: 100%;height: 50%;}
.sit{border-radius: 5px;border: 2px solid #b7b7b7;width: 88%;left: 12%;position: relative;height: 78%;font-size: 1.4vw;padding: 5px;}
/*list1傷患資料-補充說明*/
#sitrightdown{position: relative;width: 80%;height: 43%;}
.antisibr{display: none;}
@media (max-width: 950px){
  #sitone{width: 100%;height: 45%;}
  #sittitle{float: left;width: 100%;height: 25px;font-size: large;}
  .injevediv {width: 50%;height: calc(33.3% - 8.3px);float: left;}
  .injeveAId{margin: 0;font-size: medium;}
  #sitline{width: 100%;height: 55%;border-left-style: none;border-top-style: groove;padding: 5px}
  .sittoptitle{font-size: large;width: 20%;float: left;left: 0;}
  .sibr{display: none;}
  .injeveAId_text{font-size: medium;}
  .sit{float: left;width: 76%;left: 2%;height: 80%;font-size: medium;} /*neil 0923 新增fontsize*/
  .antisibr{display: block;}
}







/*遮罩*/
#hide{width: 100%;top: -100px;height: calc(100% + 100px);position: absolute;}
#hide1{min-width: 100%;min-height: 100vh;position: fixed;top: 0;left: 0;z-index: 5;overflow-y: auto;}
#giantpic{margin: auto;position:fixed;height:100%;width:100%;z-index:4;max-height:100%;max-width:100%;display:block;left: 0;top: 0;display: flex;}
#giantpic img{margin: auto;max-width: 80%;max-height: 80%;}


    </style>


</head>

<body id="body">
  <header>
    <div id="logodiv" class="left">
      <a href="http://ai.mds.com.tw/user/patients_0830neilcopy"><img src="material/LOGO.png" title="回首頁" id="rwdlogo"></a>
    </div>
    <button id="logout" class="custom-btn right">回到選擇系統</button>
    <button id="caselist" class="custom-btn right" onclick="document.location.href='http://ai.mds.com.tw/user/patients_0830neilcopy/'">案件列表</button>
    <div id="timeid" class="right">
      最後更新：<span id="timenow"></span>
    </div>
  </header>
  <main>
    
    <!--！案件列表！-->
    <div id="main_caselist">
      <div id="dateperiod" class="right"><div class="right" id="county">案發縣市：<select id="sel_county" onchange="filt_case()"><option selected value='全部'>全部</option></select></div><div class="left" id="date">日期區間：<input type="date" class="sedate" id="sdate" onchange="filt_case();sel_county_renew()">&nbsp到&nbsp<input type="date" class="sedate" id="edate" onchange="filt_case();sel_county_renew()"></div></div>
      <div id="main_table" class="left">
        <table id="data_table" class="display dtr-control"></table>
      </div>
    </div>


    <footer id="footer">
      <img src="material/patient.png" id="bg_peo">
      <img src="material/cross.png" id="bg_add">
    </footer>
    
    <!--！進入案件後！-->
    <div id="main_BNdiv">
      <!--案號與統計表-->
      <div id="statistics" class="left">
        <div class="lstatistics left">大傷案件：<a id="casePushNAME"></a></div>
        <div class="rstatistics left">目前狀態：<a id="casePushSTATE"></a></div>
        <div class="lstatistics left">大傷案號：<a id="casePushID"></a></div>
        <div class="rstatistics left">案發縣市：<a id="casePushCOUNTY"></a></div>
        <div class="lstatistics left ststatistics">開案時間：<a id="casePushTIME"></a></div>
      </div>
      
      
      <!--colordataqqqq-->
      <div id="colordata" class="left">
        <div id="colorcube">
          <div id="gray" class="cube left">總計&nbsp<a id="pushgary_data"></a></div>
          <div class="cube left black"><a id="pushohca_data"></a></div>
          <div class="cube left red"><a id="pushred_data"></a></div>
          <div class="cube left orange"><a id="pushorg_data"></a></div>
          <div class="cube left greenyellow"><a id="pushgre_data"></a></div>
        </div>
        <div id="onsitedata">
          <div id="ondata">現場數據</div>
          <div class="anvalue left" style="margin-left: 115px;">
            <button class="black point""></button>百分比：<a id="pushohca_value"></a>%
          </div>
          <div class="anvalue left">
            <button class="red point"></button>
            <button class="orange point"></button>
            <button class="greenyellow point"></button>百分比：<a id="pushrog_value"></a>%
          </div>
          <div class="anvalue left">總送醫百分比：<a id="pushtotal_value"></a>%</div>
        </div>
      </div>



      <div id="indatabox_s" class="left">
        <div id="indatarwd" class="left">傷患後送數據</div>
        <div id="indata_all">
          <div id="indata1" class="indatabox_s_box left">
            <div class="indatabox_l_box_icon left"><img src="material/data_1@2x.png"></div>
            <div class="indatabox_l_value_s ">
              <a class="green">後送途中人數</a><br> 
              <a id="pushenroute_valuepho" class="indatabox_l_value_s"></a>人(<a id="pushenroute_ppho" class="indatabox_l_value_s"></a>%)
            </div>      
          </div>
          <div id="indata2" class="indatabox_s_box left">
            <div class="indatabox_l_box_icon left"><img src="material/data_2@2x.png"></div>
            <div class="indatabox_l_value_s ">
              <a class="green">到院人數</a><br> 
              <a id="pusharrive_valuepho" class="indatabox_l_value_s"></a>人(<a id="pusharrive_ppho" class="indatabox_l_value_s"></a>%)
            </div>
          </div>
          <div id="indata3" class="indatabox_s_box left">
            <div class="indatabox_l_box_icon left"><img src="material/data_3@2x.png"></div>
            <div class="indatabox_l_value_s ">
              <a class="green">未送醫人數</a><br> 
              <a id="pushnothos_valuepho" class="indatabox_l_value_s"></a>人(<a id="pushnothos_ppho" class="indatabox_l_value_s"></a>%)
            </div>
          </div>
          <div id="indata4" class="indatabox_s_box left">
            <div class="indatabox_l_box_icon left"><img src="material/data_4@2x.png"></div>
            <div class="indatabox_l_value_s ">
              <a class="green">後送車輛數</a><br> 
              <a id="pusharrveh_valuepho" class="indatabox_l_value_s"></a>臺
            </div>
          </div>
        </div>
      </div>
      


      <div id="container" class="left">
        <div  id="indatabox_l">
          <div id="straight">傷患後送數據</div>
          <div class="indatabox_l_box">
            <div class="indatabox_l_box_icon left"><img src="material/data_1@2x.png"></div>
            <div class="indatabox_l_value ">
              <a class="green">後送途中人數</a><br> 
              <a id="pushenroute_value" class="indatabox_l_value"></a>人(<a id="pushenroute_p" class="indatabox_l_value"></a>%)
            </div>
          </div>
          <div class="indatabox_l_box">
            <div class="indatabox_l_box_icon left"><img src="material/data_2@2x.png""></div>
            <div class="indatabox_l_value ">
              <a class="green">到院人數</a><br> 
              <a id="pusharrive_value" class="indatabox_l_value"></a>人(<a id="pusharrive_p" class="indatabox_l_value"></a>%)
            </div>
          </div>
          <div class="indatabox_l_box">
            <div class="indatabox_l_box_icon left"><img src="material/data_2@2x.png""></div>
            <div class="indatabox_l_value ">
              <a class="green">未送醫人數</a><br> 
              <a id="pushnothos_value" class="indatabox_l_value"></a>人(<a id="pushnothos_p" class="indatabox_l_value"></a>%)
            </div>
          </div>
          <div class="indatabox_l_box">
            <div class="indatabox_l_box_icon left"><img src="material/data_2@2x.png""></div>
            <div class="indatabox_l_value ">
              <a class="green">後送車輛數</a><br> 
              <a id="pusharrve_value" class="indatabox_l_value"></a>臺
            </div>
          </div>
      
        </div>
        <div id="pagediv">
          <div id="patient" class="nav-item nav-item_selected left" onclick="changepage('patient')">傷病患清單</div>
          <div id="hos" class="nav-item left" onclick="changepage('hos')">後送醫院收治情形</div>
        </div>

            <!--頁籤list-->
            <div id="tab-content" class="left">
              <div id="home" class="changepage">
                <div id="selectBTN">
                  <div id="selectL" class="left">傷票級別  <!--neil 0920 新增 文字-->
                    <img id="select_ohca" class="select_triage" src="material/square_select_ohca_true.png" title="OHCA" onclick="select_toggle('select_ohca')">
                    <img id="select_red" class="select_triage" src="material/square_select_red_true.png" title="極危險" onclick="select_toggle('select_red')">
                    <img id="select_org" class="select_triage" src="material/square_select_org_true.png" title="危險" onclick="select_toggle('select_org')">
                    <img id="select_gre" class="select_triage" src="material/square_select_gre_true.png" title="輕傷" onclick="select_toggle('select_gre')">
                  </div>
                  <div id="selectR" class="left">
                    <button id="select_all" class="select_state" onclick="select_state('select_all')">全部</button>
                    <button id="select_onsite" class="select_state" onclick="select_state('select_onsite')">現場</button>
                    <button id="select_enroute" class="select_state" onclick="select_state('select_enroute')">送醫中</button>
                    <button id="select_arr" class="select_state" onclick="select_state('select_arr')">已到院</button>
                  </div>
                </div>                                          
                <!--傷病患清單表格-->
                <table id="patient_table" class="display dtn-conrtol"></table>
                  <!-- 特徵照片 -->
                <div id="myModal" style="display: none;">
                    <!--窗體外隱藏-->
                    <div id="hide" onclick="hidebox('myModal')"></div>
                      <!-- 特徵照片 content -->
                    <div id="modal-content">
                      <div id="largepicdiv"></div>
                      <div id="largepicchoosediv" class="scrollho"></div>
                    </div>
                </div>
                      
                <!-- 救護紀錄 -->
                <div id="myamrecord" style="display: none;">
                  <!--窗體外隱藏-->
                  <div id="hide" onclick="hidebox('myamrecord')"></div>
                  <!-- 救護紀錄 content -->
                  <div id="amrecord-content">
                    <div id="record"></div>
                  </div>
                </div>

                <!--傷患資料-->
                <div id="idfeature" class="feature" style="display: none;">
                  <!--窗體外隱藏-->
                  <div id="hide" onclick="hidebox('idfeature')"></div>
                  <!-- Modal content -->
                  <div id="feature-content">
                    <div id="situation">
                      <!--左-->
                      <div id="sitone" class="left">
                        <a id="sittitle">傷患評估</a>
                        <div class="injevediv"><a class="injeveAId">QRcode編碼:</a><br class="sibr"><a class="injeveAId_text" id="injeveID"></a></div>
                        <div class="injevediv"><a class="injeveAId">姓名:</a><br class="sibr"><a class="injeveAId_text" id="injeveNAME"></a></div>
                        <div class="injevediv"><a class="injeveAId">電話:</a><br class="sibr"><a class="injeveAId_text" id="injevePHONE"></a></div>
                        <div class="injevediv"><a class="injeveAId">性別:</a><br class="sibr"><a class="injeveAId_text" id="injeveSEX"></a></div>
                        <div class="injevediv"><a class="injeveAId">年齡:</a><br class="sibr"><a class="injeveAId_text" id="injeveAGE"></a></div>
                      </div>
                      <!--分隔線-->
                      <div id="sitline" class="left">
                        <div class="sitright">
                          <div class="sittoptitle">特徵說明</div>
                          <div id="sittop" class="sit"></div>
                        </div>
                        <div class="sitright">
                          <div class="sittoptitle">補充說明</div>
                          <div id="sitdown" class="sit"></div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!--list2內容-->
              <div id="menu1" class="changepage">
                <div id="list2div">
                  <table id="hos_table" class="display dtr-control"></table>
                </div>
              </div>
            </div>
          </div>
        </div>
    </main>
    
    <script type=text/javascript>


const renewt = 5000;//更新頻率
const api_CaseList = "http://172.16.30.127:9527/MCIWebApi/MCIWebApi/CaseList";
const api_CaseDetail ="http://172.16.30.127:9527/MCIWebApi/MCIWebApi/CaseDetail";
const county_order=["基隆市","臺北市","台北市","新北市","桃園市","新竹市","新竹縣","苗栗縣","臺中市","台中市","彰化縣","南投縣","雲林縣",
              "嘉義市","嘉義縣","臺南市","台南市","高雄市","屏東縣","臺東縣","台東縣","宜蘭縣","花蓮縣","澎湖縣","金門縣","連江縣"]

var minDate='0000/00/00 00:00:00';//案件過濾起始時間
var maxDate='9999/99/99 99:99:99';//案件過濾結束時間
var case_table;//案件表格
var patient_table;//病人表格
var hos_table;//病人表格
var datalist;//案件資料
var present_datalist_list=[];//案件編號list
var date_datalist=[]//案件資料時間篩選
var present_datalist=[]//案件資料呈現
var case_id='';//大傷案件編號
var filter_triage=['select_ohca','select_red','select_org','select_gre','']
var filter_state=["select_onsite",'select_enroute','select_arr','']
var present_patientdata_list=[];//病人編號list
var patientdata={};//該案件病人資料
var present_patientdata=[];//病人資料呈現
var pagination='home';//目前頁面
var hos_data=[];//後送醫院收治情形資料
var select_pid=''//詳細視窗病人ID

//
var new_present_patdata = [] 


case_table_init()

setInterval(function () {update_all()},renewt);


// case_table 初始化
function case_table_init() {
  //api_CaseList執行成功時執行 function( data ) 以下的function
  $.post( api_CaseList).done(function( data ) {
    timenow()
    datalist=data.Data;
    date_datalist=JSON.parse(JSON.stringify(datalist));  //datalist 轉為Array
    present_datalist=JSON.parse(JSON.stringify(date_datalist));  //date_datalist 轉為Array
    sel_county_renew()

    case_table = $('#data_table').DataTable( {
      "lengthMenu":[[5,10,20,50],[5,10,20,50]],"iDisplayLength":5,
      "language":{"processing": "處理中...","loadingRecords": "載入中...","lengthMenu": "每頁顯示 _MENU_ 筆資料","info": "顯示第 _START_ 至 _END_ 筆資料，共 _TOTAL_ 筆",
        "infoEmpty": "顯示第 0 至 0 筆資料，共 0 筆","infoFiltered": "","search": "搜尋:",
        "paginate": {"first": "第一頁","previous": "上一頁","next": "下一頁","last": "最後一頁"},
        "emptyTable": "無資料","zeroRecords": "無資料",
        "oAria": {"sSortAscending": ": 以升序排列此列","sSortDescending": ": 以降序排列此列"}
      } ,
      data: present_datalist,
      columns: [
        {title: '',data: 'o'},
        {title: '項次',data: 'o'},
        {title: '大傷案號',data: 'case_id'},
        {title: '大傷名稱',data: 'case_name'},
        {title: '案發縣市',data: 'case_county'},
        {title: '開案時間',data: 'case_time'},
        {title: '案件狀態',data: 'case_state',
          render: function (data, type, row) {
            return '<div class="state_but_div"><button type="button" class="state_but" onclick="casestate_btn(\''+row.case_id+'\')" id="casehome">'+data+'</button></div>'  
          }
        }],
      responsive: {details: {type: 'column'},},
      columnDefs: [ 
        {targets:0,className: 'dtr-control',orderable: false,},
        {targets: [0],width:"3%"},
        {targets: [1],orderable: false,width:"3%"},
        {targets: [2],responsivePriority: 50000},
        {targets: [3],responsivePriority: 1,orderable: false},
        {targets: [4],responsivePriority: 100000},
        {targets: [5]},
        {targets: [6],responsivePriority: 1,width:"10%"},
      ],
      order: [ 0, 'ace' ],
    });
    case_table.on('order.dt search.dt',function() {
      case_table.column(1, {search: 'applied',order: 'applied'}).nodes().each(function(cell, i) {
        cell.innerHTML = i + 1;
      });
    }).draw();
    var data_table = document.getElementById('data_table')
    data_table.style.width='100%';
  });
}




// patient_table 初始化
function patient_table_init() {
  //api_CaseList執行成功時執行 function( data ) 以下的function  //qqq case_id
  $.post( api_CaseDetail, {"case_id":case_id}).done(function( data ) {
    timenow()
    patientdata=data.Data
    present_patientdata=JSON.parse(JSON.stringify(patientdata.patient));  //patientdata.patient 轉為Array
    //new_present_patdata = present_patientdata

    patient_table = $('#patient_table').DataTable( {
      "lengthMenu":[[5,10,20,50],[5,10,20,50]],"iDisplayLength":5,
      "language":{"processing": "處理中...","loadingRecords": "載入中...","lengthMenu": "每頁顯示 _MENU_ 筆資料","info": "顯示第 _START_ 至 _END_ 筆資料，共 _TOTAL_ 筆",
        "infoEmpty": "顯示第 0 至 0 筆資料，共 0 筆","infoFiltered": "","search": "搜尋:",
        "paginate": {"first": "第一頁","previous": "上一頁","next": "下一頁","last": "最後一頁"},
        "emptyTable": "無資料","zeroRecords": "無資料",
        "oAria": {"sSortAscending": ": 以升序排列此列","sSortDescending": ": 以降序排列此列"}
      } ,
        data: present_patientdata,
        columns: [
          {title: '',data: 'o'},
          {title: '項次',data:'o'},
          {title: 'QRcode編碼',data: 'id',
            render: function (data, type, row) {
              var classname;
              if (row.state=='OHCA') {classname='ohcattriage' }
              else if (row.state=='極危險') {classname='redttriage'}
              else if (row.state=='危險') {classname='orangettriage'}
              else if (row.state=='輕傷') {classname='greenttriage'}
              return '<div class="triage ' + classname + '" >'+row.id+'</div> '
            },
          },//neil0921 title 位置('loca')修改成>狀態<                          //neil 0920 新增render
          {title: '姓名',data:'name','render':function(name){if(!name){return '-';}else{return name}}},
          {title: '性別',data: 'sex','render':function(sex){if(!sex){return '-';}else{return sex}}},
          {title: '年齡',data: 'age','render':function(age){if(!age){return '-';}else{return age}}},
          {title: '狀態',data:'loca','render':function(loca){if(!loca){return '-';}else{return loca}}},
          {title: '後送車輛',data:'car','render':function(car){if(!car){return '-';}else{return car}}},
          {title: '後送醫院',data:'hos','render':function(hos){if(!hos){return '-';}else{return hos}}},
          {title: '離開現場時間',data: 'levtime','render':function(levtime){if(!levtime){return '-';}else{return levtime}}},
          {title: '到院時間',data: 'arrtime','render':function(arrtime){if(!arrtime){return '-';}else{return arrtime}}},
          {title: '特徵照片',data: 'pho',
            render: function (data, type, row) {return '<div class="state_but_div"><button type="button" class="state_but" onclick="myBtn(\''+row.id+'\')">檢視</button></div>'}, 
          },
          {title: '救護紀錄',data: 'recor',
            render: function (data, type, row) {return '<div class="state_but_div"><button type="button" class="state_but" onclick="record(\''+row.id+'\')">檢視</button></div>'},
          },
          {title: '傷患資料',data: 'feature',
            render: function (data, type, row) {return '<div class="state_but_div"><button type="button" class="state_but" onclick="feafun(\''+row.id+'\')">檢視</button></div>'}, 
          },
        ],
        responsive: {details:{type: 'column'}},
        columnDefs: [
          {targets:0,className: 'dtr-control',orderable: false,},
          {targets: [0],width:"3%"},
          {targets: [1],responsivePriority: 1,orderable: false,width:"3%"},
          {targets: [2],responsivePriority: 100},
          {targets: [3],responsivePriority: 1,orderable: false},
          {targets: [4],responsivePriority: 100000},
          {targets: [5],responsivePriority: 100000},
          {targets: [6],responsivePriority: 1,width:"10%"},
          {targets: [11,12,13],width:"8%",responsivePriority: 10000,orderable: false},  //neil 0920 移除排序orderable
        ],
        order: [ 0, 'ace' ],
    });
    patient_table.on('order.dt search.dt',function() {
      patient_table.column(1, {
        search: 'applied',
        order: 'applied'
      }).nodes().each(function(cell, i) {cell.innerHTML = i + 1;});
    }).draw();
    var data_table = document.getElementById('patient_table')
    data_table.style.width='100%';
    update_statistics()//更新statistics左上角分析資料
    hos_table_init()//更新hos_table
    datapush() 
  });
}
 



// hos_table 初始化
function hos_table_init() {
  //list2後送醫院收治情況
  hos_data=[]
  var hos_list=[]
  //放值
  var hos_dataob_num={"hos":"","hos_level":"","hosAllPeo":0,"goHos":{"goHosRED":0,"goHosORG":0,"goHosGRE":0},"arrHos":{"arrHosRED":0,"arrHosORG":0,"arrHosGRE":0},"totalHos":{"totalHosRED":0,"totalHosORG":0,"totalHosGRE":0}}; 
  for (let i = 0;i<patientdata.patient.length;i++) { //Keys是將Object轉換成list[]
    if (patientdata.patient[i].hos!=""){
      if (hos_list.includes(patientdata.patient[i].hos)==false)  {   
        hos_list.push(patientdata.patient[i].hos)            //深淺拷貝轉換
        hos_data.push(JSON.parse(JSON.stringify(hos_dataob_num)))  //hos_dataob_num 轉為Array
        hos_data[hos_data.length-1]['hos']=patientdata.patient[i].hos;
      }
      var num = hos_list.indexOf(patientdata.patient[i].hos)

      //醫院收治總人數 
      hos_data[num]['hosAllPeo']+=1;
      //已到院
      if (patientdata.patient[i].state=="極危險") {
        if (patientdata.patient[i].loca=="已到院") {hos_data[num].arrHos.arrHosRED+=1}
        else if (patientdata.patient[i].loca=="送醫中") {hos_data[num].goHos.goHosRED+=1}
        hos_data[num].totalHos.totalHosRED+=1
      }
      else if (patientdata.patient[i].state=="危險") {
        if (patientdata.patient[i].loca=="已到院") {hos_data[num].arrHos.arrHosORG+=1}
        else if (patientdata.patient[i].loca=="送醫中") {hos_data[num].goHos.goHosORG+=1}
        hos_data[num].totalHos.totalHosORG+=1
      }
      else if (patientdata.patient[i].state=="輕傷") {
        if (patientdata.patient[i].loca=="已到院") {hos_data[num].arrHos.arrHosGRE+=1}
        else if (patientdata.patient[i].loca=="送醫中") {hos_data[num].goHos.goHosGRE+=1}
        hos_data[num].totalHos.totalHosGRE+=1
      }
    }
  }

  hos_table = $('#hos_table').DataTable( { 
    "language":{"processing": "處理中...","loadingRecords": "載入中...","lengthMenu": "每頁顯示 _MENU_ 筆資料","info": "顯示第 _START_ 至 _END_ 筆資料，共 _TOTAL_ 筆",
        "infoEmpty": "顯示第 0 至 0 筆資料，共 0 筆","infoFiltered": "","search": "搜尋:",
        "paginate": {"first": "第一頁","previous": "上一頁","next": "下一頁","last": "最後一頁"},
        "emptyTable": "無資料","zeroRecords": "無資料",
        "oAria": {"sSortAscending": ": 以升序排列此列","sSortDescending": ": 以降序排列此列"}
      },
    'searching':false,'paging':false,'info':false,
    columns: [
      { title: '收治醫院',data: 'hos'},
      { title: '醫療能力分級',data: 'hos_level'},
      { title: '收治人數',data: 'hosAllPeo'},
      { title: '送醫中',data: 'goHos',
        render: function (data, type, row) {                        //neil 0920 新增&nbsp                                                                                         //neil 0920 新增&nbsp
          return '<button class="red point"></button>&nbsp'+row.goHos.goHosRED+'<br class="antisibr"><button class="orange point"></button>&nbsp'+row.goHos.goHosORG+'<br class="antisibr"><button class="greenyellow point"></button>&nbsp'+row.goHos.goHosGRE
        }
      },
      { title: '已到院',data: 'arrHos',
        render: function (data, type, row) {
          return '<button class="red point"></button>&nbsp'+row.arrHos.arrHosRED+'<br class="antisibr"><button class="orange point"></button>&nbsp'+row.arrHos.arrHosORG+'<br class="antisibr"><button class="greenyellow point"></button>&nbsp'+row.arrHos.arrHosGRE
        }
      },
      { title: '總計',data: 'totalHos',
        render: function (data, type, row) {
          return '<button class="red point"></button>&nbsp'+row.totalHos.totalHosRED+'<br class="antisibr"><button class="orange point"></button>&nbsp'+row.totalHos.totalHosORG+'<br class="antisibr"><button class="greenyellow point"></button>&nbsp'+row.totalHos.totalHosGRE
        }
      }
    ],  
    columnDefs: [ { targets: '_all',className: 'text-center'},], 
    data: hos_data,
} );
var data_table = document.getElementById('hos_table')
    data_table.style.width='100%';
document.getElementById('menu1').classList.add('displaynone')
}

function update_all() {
  if (pagination=='home') {case_table_renew(true)}
  else {patient_table_renew(true)}
}


//case_table更新
function case_table_renew(update=false) {  
  if (update==false) {  //沒更新時執行下方
    date_datalist=JSON.parse(JSON.stringify(datalist));  //datalist 轉為Array
    var i=0;
    while (i<date_datalist.length) {  //跑每一筆資料 date_datalist
      //if date_datalist[i]任何一筆的casetime(開案時間)小於minDate 或者 大於minDate
      if (date_datalist[i].case_time < minDate | date_datalist[i].case_time > maxDate){
        date_datalist.splice(i, 1);  //刪除date_datalist Array 符合條件的一筆
      }
      else {
        i++;  //stop
      }
    }
    present_datalist=JSON.parse(JSON.stringify(date_datalist));  //datalist 轉為Array
    if (sel_county.value!='全部') {  //如果sel_county的value不等於全部 就執行下方
      var i=0;
      while (i<present_datalist.length) {  //跑每一筆資料 present_datalist
        //if present_datalis[i]任何一筆的casecounty(縣市) 不等於 sel_county.value 縣市下拉選單的值
        if ((present_datalist[i].case_county != sel_county.value )){
          present_datalist.splice(i, 1);  //刪除present_datalist Array 符合條件的一筆
        }
        else {
          i++;  //stop
        }
      }
    }
    //map(x => x.case_id) = 找出每一筆present_datalist的case_id
    present_datalist_list=present_datalist.map(x => x.case_id);  
    case_table.clear()  //清空table
    case_table.rows.add(present_datalist)  //table 新增present_datalist的資料
    case_table.draw( false );  //.draw(false) = 停留在原頁面  .draw() = 返回第一頁
    case_table.page(0).draw( false );  //首頁
  }
  else {    //api_CaseList執行成功時執行 function( data ) 以下的function
    $.post(api_CaseList).done(function( data ) {  
      var currentPage = case_table.page()
      datalist=data.Data;
      date_datalist=JSON.parse(JSON.stringify(datalist));  //datalist 轉為Array
      var i=0;
      while (i<date_datalist.length) {     //跑每一筆資料 date_datalist
      //if date_datalist[i]任何一筆的casetime(開案時間)小於minDate 或者 大於minDate
        if (date_datalist[i].case_time < minDate | date_datalist[i].case_time > maxDate){
          date_datalist.splice(i, 1);  //刪除date_datalist Array 符合條件的一筆
        }
        else {
          i++;  //stop
        }
      }
      present_datalist=JSON.parse(JSON.stringify(date_datalist));  //date_datalist 轉為Array
      if (sel_county.value!='全部') {  //如果sel_county的value不等於全部 就執行下方
        var i=0;
        while (i<present_datalist.length) {  //跑每一筆資料 present_datalist
        //if present_datalis[i]任何一筆的casecounty(縣市) 不等於 sel_county.value 縣市下拉選單的值
          if ((present_datalist[i].case_county != sel_county.value )){
            present_datalist.splice(i, 1);    //刪除present_datalist Array 符合條件的任一筆
          }
          else {
            i++;  //stop
          }
        }
      }
      for (let i=0;i<present_datalist.length;i++){  //跑每一筆資料 present_datalist
        //if present_datalist_list 內包含 present_datalist[i].case_id 就執行下方
        if (present_datalist_list.includes(present_datalist[i].case_id)){
          //case_table的行row 的 present_datalist_list 每一筆case_id add到頁面上  
          case_table.row(present_datalist_list.indexOf(present_datalist[i].case_id)).data(present_datalist[i]).draw()
        }
        else { //present_datalist_list 不包含 新資料的id 就執行下方
          case_table.rows.add(present_datalist[i]).draw();
          //push 新資料的id 到 present_datalist_list
          present_datalist_list.push(present_datalist[i].case_id)
        }
      }
      case_table.page(currentPage).draw( false );    //.draw(false) = 停留在原頁面  .draw() = 返回第一頁
      timenow();

    })
  }
}


//patient_table更新
function patient_table_renew(update=false) {
  var state=[]  //病患位置狀態
  var triage=[]  //病患受傷程度
  //if filter_state/triage 包含 select_onsite/select_org 就執行push
  if (filter_state.includes("select_onsite")) {state.push('現場')}
  if (filter_state.includes("select_enroute")) {state.push('送醫中')}
  if (filter_state.includes("select_arr")) {state.push('已到院')}
  if (filter_state.includes("")) {state.push('')}
  if (filter_triage.includes("select_org")) {triage.push('危險')}
  if (filter_triage.includes("select_ohca")) {triage.push('OHCA')}
  if (filter_triage.includes("select_red")) {triage.push('極危險')}
  if (filter_triage.includes("select_gre")) {triage.push('輕傷')}
  if (filter_triage.includes("")) {triage.push('')}
  if (update==false) {  //沒更新時 執行下方
    present_patientdata=JSON.parse(JSON.stringify(patientdata.patient));  //patientdata.patient 轉為Array
    var i=0;
    while (i<present_patientdata.length) {  //跑每一筆資料 present_patientdata
      //if triage 不包含 present_patientdata[i]每一筆的狀態state replace空格取代為空 或者 state不包含present_patientdata[i]每一筆的位置loca replace空格取代為空
      if (triage.includes(present_patientdata[i].state.replace(" ",""))==false | state.includes(present_patientdata[i].loca.replace(" ",""))==false){
        present_patientdata.splice(i, 1);  //present_patientdata Array 符合條件的任一筆
      }
      else {
        i++;  //stop
      }
    }
    //present_patientdata的每一筆id = present_patientdata_list
    present_patientdata_list=present_patientdata.map(x => x.id);
    patient_table.clear()  //清空table
    patient_table.rows.add(present_patientdata)  //table 新增present_patientdata資料
    patient_table.draw( false );  //.draw(false) = 停留在原頁面  .draw() = 返回第一頁
    patient_table.page(0).draw( false );    //.draw(false) = 停留在原頁面  .draw() = 返回第一頁
  }
  else {  //有更新時 執行下方
    //api_CaseList執行成功時執行 function( data ) 以下的function
    $.post(api_CaseDetail, {"case_id":case_id}).done(function( data ) {
      var currentPage = patient_table.page()  //現在的使用者頁面 = currentPage
      var old_present_patientdata=JSON.parse(JSON.stringify(present_patientdata));  //present_patientdata 轉為Array = 變數old_present_patientdata
      patientdata=data.Data
      present_patientdata=JSON.parse(JSON.stringify(patientdata.patient));  //patientdata.patient 轉為Array
//先抓到資料後 與舊資料比較 篩掉重複的舊資料後 得到新的資料再rows add to table
      var i=0;
      while (i<present_patientdata.length) {  //跑每一筆資料 present_patientdata
        if (triage.includes(present_patientdata[i].state.replace(" ",""))==false | state.includes(present_patientdata[i].loca.replace(" ",""))==false){
          present_patientdata.splice(i, 1);  //present_patientdata Array 符合條件的任一筆
        }
        else {
          i++;  //stop
        }
      }
      for (let i=0;i<present_patientdata.length;i++){  //跑每一筆資料 present_patientdata
        //if present_patientdata_list 不包含 present_patientdata[i]每一筆的id 執行下方
        if (present_patientdata_list.includes(present_patientdata[i].id)){ //neil 0923 bugtest .data(error)
          //patient_table 行row 的 present_datalist_list 每一筆case_id add到頁面上
          patient_table.row(present_patientdata_list.indexOf(present_patientdata[i].id)).data(present_patientdata[i]).draw()
        }
        else {  //present_patientdata_list 包含的話就 add present_patientdata[i]每筆資料
          patient_table.rows.add(present_patientdata[i]).draw();
          //present_patientdata[i]的id push到 present_patientdata_list
          present_patientdata_list.push(present_patientdata[i].id) 
        }
      }
      patient_table.page(currentPage).draw( false );  //.draw(false) = 停留在原頁面  .draw() = 返回第一頁
      timenow();
      update_statistics()//執行 function 更新statistics左上角分析資料
      hos_table_renew()//執行 function hos_table更新
      datapush()   //執行 function datapush()
      if (document.getElementById('myModal').style.display!='none') {myBtn(select_pid,true)}  //if display不等於none 執行 function >> myBtn帶入select_pid 病人id
      else if(document.getElementById('idfeature').style.display!='none') {feafun(select_pid)}  //if display不等於none 執行 function >> feafun帶入select_pid 病人id
      else if(document.getElementById('myamrecord').style.display!='none') {record(select_pid)}  //if display不等於none 執行 function >> record帶入select_pid 病人id
    })
  }
}

//hos_table更新
function hos_table_renew() {
  var hos_data=[]
  var hos_list=[]
  //案件內第二頁表格 object
  var hos_dataob_num={"hos":"","hos_level":"","hosAllPeo":0,"goHos":{"goHosRED":0,"goHosORG":0,"goHosGRE":0},"arrHos":{"arrHosRED":0,"arrHosORG":0,"arrHosGRE":0},"totalHos":{"totalHosRED":0,"totalHosORG":0,"totalHosGRE":0}}; 
  for (let i = 0;i<patientdata.patient.length;i++) {  //跑每一筆資料 patientdata.patient
    if (patientdata.patient[i].hos!=""){  // if patientdata.patient每一筆的hos不為空 執行下方
      if (hos_list.includes(patientdata.patient[i].hos)==false)  {   //if hos_list 不包含patientdata.patient[i]的hos
        hos_list.push(patientdata.patient[i].hos)  //patientdata.patient[i]的hos push到 hos_list 

      //深拷貝  //解析JSON.parse(轉換字符串JSON.stringify(hos_dataob_num)) 解析後再push到hos_data
        hos_data.push(JSON.parse(JSON.stringify(hos_dataob_num)))  //hos_dataob_num 轉為Array 再push到 hos_data array內
        hos_data[hos_data.length-1]['hos']=patientdata.patient[i].hos;  //抓到hos_data
      }
      var num = hos_list.indexOf(patientdata.patient[i].hos)

      //醫院收治總人數 
      hos_data[num]['hosAllPeo']+=1;
  //以下條件式為分類 後送醫院收治情形
      //if patientdata.patient[i]每一筆病患的狀態state == 極危險 執行下方
      if (patientdata.patient[i].state=="極危險") {
        if (patientdata.patient[i].loca=="已到院") {hos_data[num].arrHos.arrHosRED+=1}
        else if (patientdata.patient[i].loca=="送醫中") {hos_data[num].goHos.goHosRED+=1}
        hos_data[num].totalHos.totalHosRED+=1
      }
      //if patientdata.patient[i]每一筆病患的狀態state == 危險 執行下方
      else if (patientdata.patient[i].state=="危險") {
        if (patientdata.patient[i].loca=="已到院") {hos_data[num].arrHos.arrHosORG+=1}
        else if (patientdata.patient[i].loca=="送醫中") {hos_data[num].goHos.goHosORG+=1}
        hos_data[num].totalHos.totalHosORG+=1
      }
      //if patientdata.patient[i]每一筆病患的狀態state == 輕傷 執行下方
      else if (patientdata.patient[i].state=="輕傷") {
        if (patientdata.patient[i].loca=="已到院") {hos_data[num].arrHos.arrHosGRE+=1}
        else if (patientdata.patient[i].loca=="送醫中") {hos_data[num].goHos.goHosGRE+=1}
        hos_data[num].totalHos.totalHosGRE+=1
      }
    }
  }
  hos_table.clear()  //清空table
  hos_table.rows.add(hos_data)  //add hos_data
  hos_table.draw( false );  //.draw(false) = 停留在原頁面  .draw() = 返回第一頁
}

function sel_county_renew() {
  var sel_countyget=[]  //存放不重複的縣市
  var select_value=sel_county.value //原始選擇選項
  for(let i=0;i<date_datalist.length;i++) {  //跑每一筆資料 date_datalist
    //if sel_countyget 不包含 date_datalist[i].case_county &and date_datalist[i]每一筆資料 case_county 不為空!=""
    if (sel_countyget.includes(date_datalist[i].case_county)==false & date_datalist[i].case_county!="") {
      sel_countyget.push(date_datalist[i].case_county)  //date_datalist[i].case_county push 資料到 sel_countyget array
    }
  }
  for (let i=0;i<county_order.length;i++)  {  //跑每一筆資料 county_order
    if (sel_countyget.includes(county_order[i])) {
      sel_countyget.push(sel_countyget.splice(sel_countyget.indexOf(county_order[i]),1)[0])
    }
  }
  sel_county.innerHTML="<option selected value='全部'>全部</option>"; //selected預設為 全部
  for(let i=0;i<sel_countyget.length;i++) {  //跑每一筆資料 sel_countyget
    //append排序後的縣市
    sel_county.innerHTML=sel_county.innerHTML+"<option value='" + sel_countyget[i] + "'>" + sel_countyget[i] + "</option>"
  }
  if(sel_countyget.includes(select_value)){
    sel_county.value = select_value;
  }
}














function filt_case(){
  var st=document.getElementById('sdate').value;
  var et=document.getElementById('edate').value;
  //
  minDate= st=="" ? '0000/00/00 00:00:00' : st.replaceAll('-','/') + ' 00:00:00';
  maxDate= et=="" ? '9999/99/99 99:99:99' : et.replaceAll('-','/') + ' 24:00:00';
  case_table_renew()
}

function select_toggle(id) {
    if(filter_triage.includes(id)) { 
      document.getElementById(id).src="material/Rectangle_" + id + "_false.png";
      filter_triage.splice(filter_triage.indexOf(id),1)
    } 
    else {
      document.getElementById(id).src="material/square_" + id + "_true.png";
      filter_triage.push(id);
    }
    if (filter_triage.length==4 & filter_triage.includes('')==false) {
      filter_triage=['select_ohca','select_red','select_org','select_gre','']
    }
    else if (filter_triage.length!=5 & filter_triage.includes('')) {
      filter_triage.splice(filter_triage.indexOf(''),1)
    }
    patient_table_renew()
}

function select_state(id) {
  if (id=='select_all' & filter_state.length!=3) {
    filter_state=["select_onsite",'select_enroute','select_arr']
    document.getElementById('select_onsite').classList.remove("unselect_state");
    document.getElementById('select_enroute').classList.remove("unselect_state");
    document.getElementById('select_arr').classList.remove("unselect_state");
    if (filter_state.length==3 & filter_state.includes('')==false) {
      filter_state=["select_onsite",'select_enroute','select_arr','']
    }
    else if (filter_state.length!=4 & filter_state.includes('')) {
      filter_state.splice(filter_state.indexOf(''),1)
    }
    patient_table_renew()
  }
  else if (id=='select_onsite' | id=='select_enroute' | id=='select_arr') {
    if (filter_state.includes(id)) {
      filter_state.splice(filter_state.indexOf(id),1)
      document.getElementById(id).classList.add("unselect_state");
    }
    else {
      filter_state.push(id);
      document.getElementById(id).classList.remove("unselect_state");
    }
    if (filter_state.length==3 & filter_state.includes('')==false) {
      filter_state=["select_onsite",'select_enroute','select_arr','']
    }
    else if (filter_state.length!=4 & filter_state.includes('')) {
      filter_state.splice(filter_state.indexOf(''),1)
    }
    patient_table_renew()
  }
}


//案件列表-案件狀態
function casestate_btn(cid) {
  case_id = cid;
  document.getElementById('main_BNdiv').style.display = "block";
  document.getElementById("main_caselist").style.display = "none";
  document.getElementById("footer").style.display = "none";
  document.getElementById('casePushID').innerHTML=case_id;//大傷案號填入左上角
  pagination='patient'
  patient_table_init()
}

//大傷push資料至左上角
function update_statistics() {
  //大傷push資料至左上角
  //大傷案件
  document.getElementById('casePushNAME').innerHTML=patientdata.case_name;
  //大傷開案時間
  document.getElementById('casePushTIME').innerHTML=patientdata.case_time;
  //大傷案發縣市
  document.getElementById('casePushCOUNTY').innerHTML=patientdata.case_county;
  //大傷目前狀態
  document.getElementById('casePushSTATE').innerHTML=patientdata.case_state;
}






//切換分頁
function changepage(pageid) {
  if (pagination!=pageid) {
    pagination=pageid;
    $('.nav-item').removeClass('nav-item_selected')
    document.getElementById(pageid).classList.add("nav-item_selected");
    $('.changepage').addClass('displaynone')
    if (pageid=='patient') {home.classList.remove('displaynone')}
    else if (pageid=='hos') {menu1.classList.remove('displaynone')}
  }
}




function datapush() { //push表格資料
  //colordata
  document.getElementById('pushgary_data').innerHTML=patientdata.patient.length;
  var stat=[0,0,0,0]; //檢傷人數
  var pushtotal_data = 0; //送醫人數
  var enroute_value = 0;//傷患後送數據-後送途中人數
  var arrive_value = 0;//傷患後送數據-到院人數
  var nothos_value = 0; //傷患後送數據-未送醫人數
  var unik=[] //傷患後送數據-後送車輛數
  for(let i=0;i<patientdata.patient.length;i++)
  {
    if (patientdata.patient[i].state=="OHCA") {stat[0]+=1}
    else if (patientdata.patient[i].state=="極危險") {stat[1]+=1}
    else if (patientdata.patient[i].state=="危險") {stat[2]+=1}
    else if (patientdata.patient[i].state=="輕傷") {stat[3]+=1}

    if (patientdata.patient[i].hos.replace(" ","")!=""){ pushtotal_data+=1 }
    if (patientdata.patient[i].car.replace(" ","")!=""){ enroute_value+=1 }
    if (patientdata.patient[i].arrtime.replace(" ","")!=""){ arrive_value+=1 }
    if (patientdata.patient[i].car.replace(" ","")==""){ nothos_value+=1 }
    if (unik.includes(patientdata.patient[i].car)==false & patientdata.patient[i].car!="") {
      unik.push(patientdata.patient[i].car) //將car push到unik陣列
    }
  }
  document.getElementById('pushohca_data').innerHTML=String(stat[0]);
  document.getElementById('pushred_data').innerHTML=String(stat[1]);
  document.getElementById('pushorg_data').innerHTML=String(stat[2]);
  document.getElementById('pushgre_data').innerHTML=String(stat[3]);
  //colordata百分比
  document.getElementById('pushrog_value').innerHTML=patientdata.patient.length==0 ? '_' : String(((stat[1]+stat[2]+stat[3])/patientdata.patient.length*100).toFixed(1));
  document.getElementById('pushohca_value').innerHTML=patientdata.patient.length==0 ? '_' : String((stat[0]/patientdata.patient.length*100).toFixed(1));
  //總送醫百分比
  document.getElementById('pushtotal_value').innerHTML=patientdata.patient.length==0 ? '_' : String((pushtotal_data/patientdata.patient.length*100).toFixed(1));
  //傷患後送數據
  //傷患後送數據-後送途中人數
  document.getElementById('pushenroute_value').innerHTML=String(enroute_value);
  document.getElementById('pushenroute_p').innerHTML=patientdata.patient.length==0 ? '_' : String((enroute_value/patientdata.patient.length*100).toFixed(1));

  document.getElementById('pushenroute_valuepho').innerHTML=String(enroute_value);
  document.getElementById('pushenroute_ppho').innerHTML=patientdata.patient.length==0 ? '_' : String((enroute_value/patientdata.patient.length*100).toFixed(1));
  //傷患後送數據-到院人數
  document.getElementById('pusharrive_value').innerHTML=String(arrive_value);
  document.getElementById('pusharrive_p').innerHTML=patientdata.patient.length==0 ? '_' : String((arrive_value/patientdata.patient.length*100).toFixed(1));

  document.getElementById('pusharrive_valuepho').innerHTML=String(arrive_value);
  document.getElementById('pusharrive_ppho').innerHTML=patientdata.patient.length==0 ? '_' : String((arrive_value/patientdata.patient.length*100).toFixed(1));
  //傷患後送數據-未送醫人數
  document.getElementById('pushnothos_value').innerHTML=String(nothos_value);
  document.getElementById('pushnothos_p').innerHTML=patientdata.patient.length==0 ? '_' : String((nothos_value/patientdata.patient.length*100).toFixed(1));

  document.getElementById('pushnothos_valuepho').innerHTML=String(nothos_value);
  document.getElementById('pushnothos_ppho').innerHTML=patientdata.patient.length==0 ? '_' : String((nothos_value/patientdata.patient.length*100).toFixed(1));
  //傷患後送數據-後送車輛數
  document.getElementById('pusharrve_value').innerHTML=String(unik.length);
  document.getElementById('pusharrveh_valuepho').innerHTML=String(unik.length);
} 


/*list2表格*/


/*最後更新時間*/
function timenow() {
    var date = new Date;
    var str="";
    str += date.getHours()<12?"上午 ":"下午 ";
    str += ('0' + date.getHours()).slice(-2) + ' : ' + ('0' + date.getMinutes()).slice(-2) + ' : ' + ('0' + date.getSeconds()).slice(-2);
    document.getElementById('timenow').innerHTML=str;
}






//特徵照片qqqq
function myBtn(id,update=false) {
  select_pid=id;
  //先透過id抓資料跑迴圈後載入圖片
  var data_temp;
  var largepicchoosediv = document.getElementById('largepicchoosediv')
  for(let i=0;i<present_patientdata.length;i++) {    //跑每一筆資料 present_patientdata
    if (present_patientdata[i].id==id){
      data_temp=present_patientdata[i]
      break
    }
    if (i==present_patientdata.length-1){
      alert('error,找不到data,還請您重新整理')
      continue
    }
  }
  document.getElementById("myModal").style.display = "block";
  document.getElementById("hide").style.display = "block";
  //push大圖
  if (update==false) {
    largepicchoosediv.innerHTML=""
    if (data_temp.pho.length!=0) {
      document.getElementById('largepicdiv').innerHTML='<img src="' + data_temp.pho[0] + '" id="delphobig" onclick="enlarge_mainphoto()">'
    }
    else {
      document.getElementById('largepicdiv').innerHTML='<img src="material/nodata.png" id="delphobig" onclick="enlarge_mainphoto()">'
    }
  }
  if (document.getElementById('delphobig').src.includes("nodata.png") & data_temp.pho.length!=0) {
    document.getElementById('largepicdiv').innerHTML='<img src="' + data_temp.pho[0] + '" id="delphobig" onclick="enlarge_mainphoto()">'
    }

  //特徵照片button迴圈
  //增加
  for(let i=0;i<data_temp.pho.length;i++) {
    if (largepicchoosediv.innerHTML.includes(data_temp.pho[i])==false) {
      var img=document.createElement('img');
      img.src=data_temp.pho[i];img.setAttribute('onclick', 'chmainphoto("' + data_temp.pho[i] + '")');
      largepicchoosediv.appendChild(img)
    }
  }
  //減少
  for (let i=0;i<largepicchoosediv.childElementCount;i++) {
    var rmimg=largepicchoosediv.children[i]
    if (data_temp.pho.includes(rmimg.src)==false){
      largepicchoosediv.removeChild(rmimg)
    }
  }
}
  
//救護紀錄
function record(id) {
  select_pid=id;
  //先透過id抓資料跑迴圈後載入PDF
  var data_record;
  var recorddata
  console.log(present_patientdata);
  console.log(id);
  for(let i=0;i<present_patientdata.length;i++)  //跑每一筆資料 present_patientdata
  {
    if (present_patientdata[i].id==id){
      data_record=present_patientdata[i]
      break
    }
    if (i==present_patientdata.length-1){
      alert('error,找不到data,還請您重新整理12313')
      continue
    }
  }
  document.getElementById("myamrecord").style.display = "block";
  recorddata=data_record.recor.length==0 ? '<img src="material/nodata.png">' : '<iframe src="' + data_record.recor[0] + '" id="delpdf">'
  if (document.getElementById("record").innerHTML!=recorddata) {
    document.getElementById("record").innerHTML=recorddata;
  }
}

//傷患資料
function feafun(id) {
  select_pid=id;
  var data_fea;
  for(let i=0;i<present_patientdata.length;i++)  //跑每一筆資料 present_patientdata
  {
    if (present_patientdata[i].id==id){
      data_fea=present_patientdata[i]
      break
    }
    if (i==present_patientdata.length-1){
      alert('error,找不到data,還請您重新整理')
      continue
    }
  }
  document.getElementById("idfeature").style.display = "block";
  //傷患評估
  //傷患資料-身分證ID
  document.getElementById('injeveID').innerHTML=data_fea.id;
  //傷患資料-NAME
  document.getElementById('injeveNAME').innerHTML=data_fea.name;
  //傷患資料-PHONE
  document.getElementById('injevePHONE').innerHTML=data_fea.injevePHONE;
  //傷患資料-SEX
  document.getElementById('injeveSEX').innerHTML=data_fea.sex;
  //傷患資料-AGE
  document.getElementById('injeveAGE').innerHTML=data_fea.age;
  //特徵說明
  document.getElementById('sittop').innerHTML=data_fea.featureR;
  //補充說明
  document.getElementById('sitdown').innerHTML=data_fea.featureRD;
}


//patient_table-窗體外關閉視窗
function hidebox(id){
  document.getElementById(id).style.display='none';
  document.getElementById('hide').style.display='none';
}



//patient_table-特徵照片
function enlarge_mainphoto(){
  var src;
  for (let i=0; i<document.getElementById('largepicdiv').children.length;i++) {
    if (document.getElementById('largepicdiv').children[i].src!='') {
      src=document.getElementById('largepicdiv').children[i].src
      break
    }
  }
  var div= document.createElement("div");
  div.id="hide1"
  div.setAttribute('onclick', 'hidebox1()');
  var bigdiv= document.createElement("div");
  bigdiv.id="giantpic"
  bigdiv.innerHTML='<img src="' + src + '">' ;
  document.getElementById("body").appendChild(bigdiv);
  document.getElementById("body").append(div);
}

//窗體外關閉視窗
function hidebox1(){
  var del=document.getElementById('hide1')
      del.parentElement.removeChild(del)
  var del=document.getElementById('giantpic')
      del.parentElement.removeChild(del)
}

//切換主要照片
function chmainphoto (url) {
  var delphobig=document.getElementById('delphobig');
  delphobig.src=url
}




    </script>
</body>
</html>